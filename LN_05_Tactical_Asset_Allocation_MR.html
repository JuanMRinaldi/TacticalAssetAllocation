

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>COMM475 &#8212; COMM475 - Investment Policies | Tactical Asset Allocation</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=b09b2da44b9015b4fa76ea072fa2d8f7faee5492" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=eed9c059a3ee152aae2353ec732f0a6d12e6aa07"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'LN_05_Tactical_Asset_Allocation_MR';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to COMM475 - Investment Policies | Tactical Asset Allocation" href="intro.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Lorenzo Garlappi, Martin Rinaldi, and Tina Tian" />
<meta name="keywords" content="" />
<meta name="description" content=COMM475Investment Policies: Tactical Asset Allocation  Instructor: Lorenzo Garlappi  TAs:  Martin Rinaldi  Tina Tian  &lt;/div&gt;   &lt;style&gt; .custom-container {     p />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:title" content="COMM475"/>
<meta name="twitter:description" content="COMM475Investment Policies: Tactical Asset Allocation  Instructor: Lorenzo Garlappi  TAs:  Martin Rinaldi  Tina Tian  &lt;/div&gt;   &lt;style&gt; .custom-container {     p">
<meta name="twitter:creator" content="@">
<meta name="twitter:image" content="">

<!-- Opengraph tags -->
<meta property="og:title" content="COMM475" />
<meta property="og:type" content="website" />
<meta property="og:url" content="None" />
<meta property="og:image" content="" />
<meta property="og:description" content="COMM475Investment Policies: Tactical Asset Allocation  Instructor: Lorenzo Garlappi  TAs:  Martin Rinaldi  Tina Tian  &lt;/div&gt;   &lt;style&gt; .custom-container {     p" />
<meta property="og:site_name" content="COMM475 - Investment Policies | Tactical Asset Allocation" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=LN_05_Tactical_Asset_Allocation_MR>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">COMM475</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#investment-policies-tactical-asset-allocation">Investment Policies: Tactical Asset Allocation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instructor-lorenzo-garlappi">Instructor: Lorenzo Garlappi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tas">TAs:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#martin-rinaldi">Martin Rinaldi</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tina-tian">Tina Tian</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">Outline</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subcategories-of-dynamic-asset-allocation">1. Subcategories of Dynamic Asset Allocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-contrarian-taa-principle-as-applied-to-taa">2. The Basic ‘‘Contrarian’’ TAA Principle as Applied to TAA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-models">3. TAA Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-taa-measures">4. Practical TAA Measures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5. Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#warm-up">Warm up</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-definitions-of-saa-taa-and-iaa">1. TAA: Definitions of SAA, TAA and IAA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-william-sharpes-characterization-of-saa-taa-and-iaa">TAA: William Sharpe’s characterization of SAA, TAA and IAA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-following-functions-calculate-k0-k1-and-stock-weight-from-assets-volatility-and-returns">The following functions calculate K0, K1 and stock weight from assets volatility and returns.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#suppose-that-the-investor-becomes-more-risk-tolerant-as-his-her-wealth-increases-what-happens-to-the-portfolio-weight-in-stocks-x-st">Suppose that the investor becomes more risk tolerant as his/her wealth increases. What happens to the portfolio weight in stocks, <span class="math notranslate nohighlight">\(X_{st}\)</span>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-mean-reversion-in-the-stock-index-price-level-negative-serial-correlation-in-stock-index-returns">TAA: Mean Reversion in the Stock Index Price Level (Negative Serial Correlation in Stock Index Returns)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-a-mean-reverting-stock-index">TAA: A Mean-Reverting Stock Index</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-the-general-taa-methodology">2. TAA: The General TAA Methodology</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-t-r">Determining <span class="math notranslate nohighlight">\(𝑬_{𝒕}[𝒓_{𝑺}]\)</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-the-fama-french-ff-predictive-model">3. TAA: The Fama-French (FF) Predictive Model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-fama-french-results">TAA: Fama-French Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-1">Fama-French Paper Result 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-2">Fama-French Paper Result 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-3">Fama-French Paper Result 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-4">Fama-French Paper Result 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-5">Fama-French Paper Result 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-6">Fama-French Paper Result 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-7">Fama-French Paper Result 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fama-french-paper-result-7-cont">Fama-French Paper Result 7 (cont.)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-chen-predictive-model">4. TAA: Chen Predictive Model</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chens-original-analysis">Chen’s original analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-overview-of-risk-factors-used-in-the-chen-predictive-model">An Overview of Risk Factors Used in the Chen Predictive Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictor-variables">Predictor Variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-predictivity-of-risk-factors-on-evw-t-is-as-follows">The predictivity of risk factors on <span class="math notranslate nohighlight">\(EVW_{t}\)</span> is as follows:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-on-risk-factors">Results on risk factors:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictivity-of-risk-factors-on-the-growth-rate-of-gnp-is-as-follows">Predictivity of risk factors on the growth rate of GNP is as follows:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#source-chen1991-table-4-p538">source: Chen1991 Table 4 (p538)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updated-chens-analysis">Updated Chen’s analysis</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-contrarian-taa-versus-momentum-taa">5. TAA: Contrarian TAA Versus Momentum TAA</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-estimating-the-erp-directly">6. TAA: Estimating the ERP Directly</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-erp-directly-a-numerical-example">Estimating the ERP Directly: A Numerical Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#taa-a-simple-taa-implementation">7. TAA: A Simple TAA Implementation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">Appendix</a></li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href="intro.html"><img src="_static/UBC.jpeg" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">COMM475 - Investment Policies | Tactical Asset Allocation</a></p>

                        <p class="qe-page__header-subheading">COMM475</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">Lorenzo Garlappi, Martin Rinaldi, and Tina Tian</p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div class="custom-container">
<section class="tex2jax_ignore mathjax_ignore" id="comm475">
<h1>COMM475<a class="headerlink" href="#comm475" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="investment-policies-tactical-asset-allocation">
<h1>Investment Policies: Tactical Asset Allocation<a class="headerlink" href="#investment-policies-tactical-asset-allocation" title="Permalink to this heading">#</a></h1>
<section id="instructor-lorenzo-garlappi">
<h2>Instructor: Lorenzo Garlappi<a class="headerlink" href="#instructor-lorenzo-garlappi" title="Permalink to this heading">#</a></h2>
</section>
<section id="tas">
<h2>TAs:<a class="headerlink" href="#tas" title="Permalink to this heading">#</a></h2>
<section id="martin-rinaldi">
<h3>Martin Rinaldi<a class="headerlink" href="#martin-rinaldi" title="Permalink to this heading">#</a></h3>
</section>
<section id="tina-tian">
<h3>Tina Tian<a class="headerlink" href="#tina-tian" title="Permalink to this heading">#</a></h3>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="outline">
<h1>Outline<a class="headerlink" href="#outline" title="Permalink to this heading">#</a></h1>
<section id="subcategories-of-dynamic-asset-allocation">
<h2>1. Subcategories of Dynamic Asset Allocation<a class="headerlink" href="#subcategories-of-dynamic-asset-allocation" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><p><img alt="DAA: Subcategories" src="_images/TeachingNotes_Lorenzo.png" /></p>
<div class="custom-container">
</section>
<section id="the-basic-contrarian-taa-principle-as-applied-to-taa">
<h2>2. The Basic ‘‘Contrarian’’ TAA Principle as Applied to TAA<a class="headerlink" href="#the-basic-contrarian-taa-principle-as-applied-to-taa" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Mean reversion in stock prices (negative return correlation)</p></li>
</ul>
</section>
<section id="taa-models">
<h2>3. TAA Models<a class="headerlink" href="#taa-models" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The General Methodology of Estimating the Equity Risk Premium (ERP)</p></li>
<li><p>Fama, French (FF) Predictive Model</p></li>
<li><p>Chen Predictive Model</p></li>
</ul>
</section>
<section id="practical-taa-measures">
<h2>4. Practical TAA Measures<a class="headerlink" href="#practical-taa-measures" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>How to Estimate ERP directly</p></li>
<li><p>A Simple TAA Implementation</p></li>
</ul>
</section>
<section id="summary">
<h2>5. Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The ERP is hard to predict</p></li>
<li><p>The ERP is related to the business cycle</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="warm-up">
<h2>Warm up<a class="headerlink" href="#warm-up" title="Permalink to this heading">#</a></h2>
<p>Before we start, let’s first install the dependencies and import the libraries we need.</p>
<p>Please follow steps 1 and 2 below to be able to run this notebook on your local machine.</p>
<ol class="arabic simple">
<li><p>Install Dependencies: Run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code> in the terminal to install all required packages.</p></li>
<li><p>Run the setup cell bellow.</p></li>
</ol>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup environment</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-definitions-of-saa-taa-and-iaa">
<h1>1. TAA: Definitions of SAA, TAA and IAA<a class="headerlink" href="#taa-definitions-of-saa-taa-and-iaa" title="Permalink to this heading">#</a></h1>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<section id="taa-william-sharpes-characterization-of-saa-taa-and-iaa">
<h2>TAA: William Sharpe’s characterization of SAA, TAA and IAA<a class="headerlink" href="#taa-william-sharpes-characterization-of-saa-taa-and-iaa" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>After a market move:</p>
<blockquote>
<div><p>For TAA: Go back to point A</p>
<blockquote>
<div><p>Adjust <strong>expectations</strong> about asset returns</p>
</div></blockquote>
</div></blockquote>
<blockquote>
<div><p>For SAA: Rebalance to SAA weights in point B</p>
<blockquote>
<div><p>Adjust portfolio <strong>weights</strong></p>
</div></blockquote>
</div></blockquote>
<blockquote>
<div><p>For IAA: Go back to point C</p>
<blockquote>
<div><p>Update <strong>preferences</strong> (e.g., risk tolerance) as a result of change in wealth</p>
</div></blockquote>
</div></blockquote>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Assume two possible investments:</p>
<ul class="simple">
<li><p>Bonds with <span class="math notranslate nohighlight">\(E[r_{B}]\)</span>  and <span class="math notranslate nohighlight">\(\sigma_{B}\)</span></p></li>
<li><p>Stocks with <span class="math notranslate nohighlight">\(E[r_{S}]\)</span>  and <span class="math notranslate nohighlight">\(\sigma_{S}\)</span></p></li>
<li><p>Covariance between bonds and stock: <span class="math notranslate nohighlight">\(\sigma_{BS}\)</span></p></li>
</ul>
<p>The investor chooses <span class="math notranslate nohighlight">\(X_{st}\)</span> as the proportion invested in stock at date <span class="math notranslate nohighlight">\(t\)</span>, with <span class="math notranslate nohighlight">\(1-X_{st}\)</span> invested in bonds, to maximize the investor’s expected utility, with a <strong>relative risk tolerance</strong> (<span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span>), which depends upon the investor’s wealth, <span class="math notranslate nohighlight">\(W_{t}\)</span> at date <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p><span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span> increases with <span class="math notranslate nohighlight">\(W_{t}\)</span>: as wealth goes up, an investor gets more aggressive, i.e., is willing to take more risk.</p>
<p>The portfolio choice problem for the investor:
$<span class="math notranslate nohighlight">\(\max_{X_{st}} E[R_{t}] -  \frac{1}{2RRT[W_{t}]} V[R_{t}]\)</span>$</p>
<p>where <span class="math notranslate nohighlight">\(E[R_{t}] = X_{st} \cdot E[r_{S}] + (1-X_{st}) \cdot E[r_{B}]\)</span>, and <span class="math notranslate nohighlight">\(V[R_{t}] = X_{st}^{2}\sigma_{S}^{2} + (1-X_{st})^{2}\sigma_{B}^{2} + 2X_{st}(1-X_{st})\sigma_{BS}\)</span></p>
<p>Take first order condition on <span class="math notranslate nohighlight">\(X_{st}\)</span>:</p>
<div class="math notranslate nohighlight">
\[E[r_{S}] - E[r_{B}] -\frac{1}{2RRT[W_{t}]}\Big(2X_{st}\sigma_{S}^{2} + 2(1-X_{st})\sigma_{B}^{2} - 4X_{st}(1-X_{st})\sigma_{BS} + 2\sigma_{BS} - 2\sigma_{B}^{2}\Big) = 0\]</div>
<p>The solution takes the following form:</p>
<div class="math notranslate nohighlight">
\[X_{st}=K_{0}+K_{1t} \cdot RRT[W_{t}]\]</div>
<p>Where <span class="math notranslate nohighlight">\(K_{0}\)</span> and <span class="math notranslate nohighlight">\(K_{1t}\)</span> are constants given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
 K_{0}&amp;=\frac{\sigma_{B}^2-\sigma_{BS}}{\sigma_{B}^2+\sigma_{S}^2-2\sigma_{BS}}\\
  K_{1t}&amp;=\frac{E_{t} [r_{S}]-E[r_{B}]}{\sigma_{B}^2+\sigma_{S}^2-2\sigma_{BS}}
\end{align*}\]</div>
<p><strong>SAA Investing</strong>:</p>
<p><span class="math notranslate nohighlight">\(K_{0}\)</span>, <span class="math notranslate nohighlight">\(K_{1t}\)</span> and <span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span> are all taken as constant and unchanging over time under SAA. This assumes:</p>
<blockquote>
<div><p>(i) no changes in risk assessments (<span class="math notranslate nohighlight">\(\sigma_{B},\sigma_{S},\sigma_{BS}\)</span>)</p>
</div></blockquote>
<blockquote>
<div><p>(ii) no changes in expected stock returns <span class="math notranslate nohighlight">\(E_{t}[r_{S}]=E[r_{S}]\)</span> is independent of <span class="math notranslate nohighlight">\(t\)</span>, i.e., it is a long-run expectation</p>
</div></blockquote>
<blockquote>
<div><p>(iii) no change in <span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span> because SAA assumes the investor doesn’t worry about short-run changes in wealth.</p>
</div></blockquote>
<p>With these three assumptions, SAA is thus assuming that <span class="math notranslate nohighlight">\(X_{st}\)</span> is the same at each date <span class="math notranslate nohighlight">\(t\)</span>. The Mean-Variance Efficient Frontier (MVEF) does not move, and the optimal point on that curve (determined by the investor’s <span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span>) does not move.</p>
<p><strong>TAA Investing</strong>:</p>
<p>We continue to assume (in all three DAA styles) that there are no changes in risk assessments (<span class="math notranslate nohighlight">\(\sigma_{B},\sigma_{S},\sigma_{BS}\)</span>). BUT, with TAA, the investor alters their <span class="math notranslate nohighlight">\(E_{t}[r_{S}]\)</span> at each date <span class="math notranslate nohighlight">\(t\)</span>, as the investor alters the belief about upcoming stock expected returns. For simplicity, we assume <span class="math notranslate nohighlight">\(E[r_{B}]\)</span> does not change. Thus, <span class="math notranslate nohighlight">\(K_{1t}\)</span> changes at each date <span class="math notranslate nohighlight">\(t\)</span> so that <span class="math notranslate nohighlight">\(X_{st}\)</span> changes at each date <span class="math notranslate nohighlight">\(t\)</span>. As <span class="math notranslate nohighlight">\(E_{t}[r_{S}]-E[r_{B}]\)</span> increases, so does <span class="math notranslate nohighlight">\(X_{st}\)</span>. Because expected returns change, the MVEF changes, but the <span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span> is assumed to stay constant in TAA. So, the TAA investor will change their portfolio weighting each period as their outlook for the stock market changes each period.</p>
<p><strong>IAA Investing</strong>:</p>
<p>In IAA investing, <span class="math notranslate nohighlight">\(RRT[W_{t}]\)</span> changes at each date as the investor’s wealth changes: when <span class="math notranslate nohighlight">\(W_{t}\)</span> gets bigger, risk tolerance also increases (<span class="math notranslate nohighlight">\(RRT\)</span> increases) as the investor is more aggressive when she is wealthier. Thus, <span class="math notranslate nohighlight">\(X_{st}\)</span> changes at each date as <span class="math notranslate nohighlight">\(RRT\)</span> changes: higher wealth means a bigger <span class="math notranslate nohighlight">\(RRT\)</span> which means a bigger <span class="math notranslate nohighlight">\(X_{st}\)</span>. The MVEF does not move, but the <span class="math notranslate nohighlight">\(RRT\)</span> point on the curve does, so <span class="math notranslate nohighlight">\(X_{st}\)</span> moves.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="the-following-functions-calculate-k0-k1-and-stock-weight-from-assets-volatility-and-returns">
<h2>The following functions calculate K0, K1 and stock weight from assets volatility and returns.<a class="headerlink" href="#the-following-functions-calculate-k0-k1-and-stock-weight-from-assets-volatility-and-returns" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate K0</span>
<span class="k">def</span> <span class="nf">K0</span><span class="p">(</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">):</span>
  <span class="n">K0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_b</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">K0</span>

<span class="c1"># calculate K1</span>
<span class="k">def</span> <span class="nf">K1</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">):</span>
  <span class="n">K1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span><span class="o">-</span><span class="n">rb</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_b</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">K1</span>

<span class="c1"># calculate stock weight</span>
<span class="k">def</span> <span class="nf">stock_weight</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">,</span><span class="n">RRT</span><span class="p">):</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">sigma_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span>
  <span class="n">sigma_bs</span> <span class="o">=</span> <span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span>
  <span class="n">K0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigma_bs</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span>
  <span class="n">K1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span> <span class="o">-</span> <span class="n">rb</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span>
  <span class="k">return</span> <span class="n">K0</span><span class="o">+</span><span class="n">RRT</span><span class="o">*</span><span class="n">K1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="n">rb</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">rs</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sigma_b</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">sigma_s</span> <span class="o">=</span> <span class="mf">0.30</span>
<span class="n">corr</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">RRT</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K0 is:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K0</span><span class="p">(</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K1 is:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K1</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;The stock weight X[st] chosen by the investor is:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">stock_weight</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">sigma_s</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">RRT</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>K0 is: 0.712
K1 is: 0.169
The stock weight X[st] chosen by the investor is: 0.345
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
</section>
<section id="suppose-that-the-investor-becomes-more-risk-tolerant-as-his-her-wealth-increases-what-happens-to-the-portfolio-weight-in-stocks-x-st">
<h2>Suppose that the investor becomes more risk tolerant as his/her wealth increases. What happens to the portfolio weight in stocks, <span class="math notranslate nohighlight">\(X_{st}\)</span>?<a class="headerlink" href="#suppose-that-the-investor-becomes-more-risk-tolerant-as-his-her-wealth-increases-what-happens-to-the-portfolio-weight-in-stocks-x-st" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="taa-mean-reversion-in-the-stock-index-price-level-negative-serial-correlation-in-stock-index-returns">
<h2>TAA: Mean Reversion in the Stock Index Price Level (Negative Serial Correlation in Stock Index Returns)<a class="headerlink" href="#taa-mean-reversion-in-the-stock-index-price-level-negative-serial-correlation-in-stock-index-returns" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The basic hypothesis of contrarian TAA investing is that the stock index price level fluctuates around its long-term trend line, overshooting too high, reverting back, and then overshooting too low and reverting back, etc. The graph on the next page (mean-reverting stock index) illustrates this viewpoint.</p>
<ul class="simple">
<li><p>When the index is too low:</p></li>
</ul>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(E[r_{S}]\)</span> is <u>greater than</u> the long-term trend line. The simple theory: investors are poor (the stock index is low, so stock wealth is small) and so they demand a higher <span class="math notranslate nohighlight">\(E[r_{S}]\)</span> before being willing to invest in risky stocks.</p>
</div></blockquote>
<ul class="simple">
<li><p>When the index is too high:</p></li>
</ul>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(E[r_{s}]\)</span> is <u>less than</u> the long-term trend line (although it should never be less than the riskless rate). The simple theory: investors are rich (the stock index is high, so stock market wealth is large) and so they are willing, even at a low <span class="math notranslate nohighlight">\(E[r_{S}]\)</span>, to invest in risky stocks.</p>
</div></blockquote>
<p>In this contrarian TAA model, the stock index price level reverts back to its long-run trend line when it deviates too far from that trend line.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="taa-a-mean-reverting-stock-index">
<h2>TAA: A Mean-Reverting Stock Index<a class="headerlink" href="#taa-a-mean-reverting-stock-index" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Assume investors perceive the stock index behaving as shown below. We see it mean-reverting around a growth trend. At times of a high stock index level, investors are rich and they are willing to accept a lower expected return to bear the risk of the stock market. At a low stock index level, investors are poor and demand a high expected growth rate in order for them to bear risk.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><p><img alt="TAA: A Mean-Reverting Stock Index" src="_images/Mean_Reversion.png" /></p>
<div class="custom-container">
<p>Thus, as investors’ attitude towards bearing risk changes, the “market price of risk / risk premium” (<span class="math notranslate nohighlight">\(\lambda\)</span> in the CAPM) changes. <span class="math notranslate nohighlight">\(\lambda\)</span> is positively related to the expected return on the stock market, <span class="math notranslate nohighlight">\(E[r_{S}]\)</span>.</p>
<ul class="simple">
<li><p>When price gets too high, it reverts back to the long-term trend, but usually over-shoots and goes too low.</p></li>
<li><p>When price is low, <span class="math notranslate nohighlight">\(E[r_{S}]\)</span> is high, and vice-versa.</p></li>
</ul>
<p>A contrarian investor may take market risk as constant. Then as expected market return varies (low price means high <span class="math notranslate nohighlight">\(E[r_{S}]\)</span> and high price means low <span class="math notranslate nohighlight">\(E[r_{S}]\)</span>, the reward-to-risk ratio of investing in the market varies. The contrarian investor invests when price is low, so the reward-to-risk ratio is high.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-the-general-taa-methodology">
<h1>2. TAA: The General TAA Methodology<a class="headerlink" href="#taa-the-general-taa-methodology" title="Permalink to this heading">#</a></h1>
<section id="determining-t-r">
<h2>Determining <span class="math notranslate nohighlight">\(𝑬_{𝒕}[𝒓_{𝑺}]\)</span><a class="headerlink" href="#determining-t-r" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The TAA manager must identify predictor variables, which are economic (or behavioral) variables that can be observed at regular intervals (e.g., monthly) that the manager believes predict future asset returns. That is:</p>
<p><strong>Predictor variables forecast <span class="math notranslate nohighlight">\(E_{t} [r_{S}]\)</span></strong> (and/or other asset class expectations). The TAA process has two steps:</p>
<p><strong>TAA Step 1</strong>. Find predictor variables and determine their relationship to <span class="math notranslate nohighlight">\(E_{t} [r_{S}]\)</span></p>
<p>Finding predictor variables that are correlated with future stock returns is usually done with regression analysis, by regressing stock returns on predictor variables that are observable before the stock return occurs:</p>
<div class="math notranslate nohighlight">
\[r_{sq} = a + b_{1}PV_{1q} + b_{2}PV_{2q} + e\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(PV_{1q}\)</span> and <span class="math notranslate nohighlight">\(PV_{2q}\)</span> are the observations of the predictor variables at <strong>the start</strong> of quarter <span class="math notranslate nohighlight">\(q\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(r_{sq}\)</span> is the stock index return over quarter <span class="math notranslate nohighlight">\(q\)</span></p></li>
</ul>
<p>When a relationship is found, stock returns are predicted from the regression model:</p>
<div class="math notranslate nohighlight">
\[E[r_{sq}] = a' + b_{1}'PV_{1q} + b_{2}'PV_{2q}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E[r_{sq}]\)</span> is the prediction made for the upcoming quarter <span class="math notranslate nohighlight">\(q\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(a'\)</span>, <span class="math notranslate nohighlight">\(b_{1}'\)</span> and <span class="math notranslate nohighlight">\(b_{2}'\)</span> are the coefficients from the regression above based on historical data</p></li>
<li><p><span class="math notranslate nohighlight">\(PV_{1q}\)</span> and <span class="math notranslate nohighlight">\(PV_{2q}\)</span> are the current (at the start of quarter <span class="math notranslate nohighlight">\(q\)</span>) observations of the predictor variables</p></li>
</ul>
<p><strong>TAA Step 2</strong>. Convert the <span class="math notranslate nohighlight">\(E_{t}[r_{S}]\)</span> estimate to a stock/bond allocation in your TAA portfolio</p>
<p>Once the stock return is estimated, it must be converted to a TAA allocation (i.e., how much in stock and how much in other asset classes?). This is achieved by mean-variance analysis.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-the-fama-french-ff-predictive-model">
<h1>3. TAA: The Fama-French (FF) Predictive Model<a class="headerlink" href="#taa-the-fama-french-ff-predictive-model" title="Permalink to this heading">#</a></h1>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<div class="custom-container">
<p>In this section, we report the original analysis from Fama-French predictive model and then followed with python code to reproduce the results.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>We think of TAA as arising because the TAA investor believes in a time-varying equity risk premium (ERP). For example, in the CAPM, we say the “market price of risk” (<span class="math notranslate nohighlight">\(𝐸RP =𝐸[𝑟_{𝑚}]−𝑟_{𝑓})\)</span> is a constant. But, in TAA, we assume that the compensation investors want for bearing stock market risk (this is the “market price of risk”) varies through time.</p>
<p>FF describe a consumption smoothing story about a time-varying equity risk premium (ERP).</p>
<ul class="simple">
<li><p>At an economic peak, investors’ income is higher than their desired consumption, so all investors seek investments: this drives prices of risky assets up and expected returns down.</p></li>
<li><p>At an economic trough, investors’ income is less than their desired consumption, so they must liquidate their investments to consume; this drives prices of risky assets down and expected returns up. This links expected returns (like the ERP) to the economic cycle: high expected returns at economic troughs and low expected returns at economic peaks.</p></li>
</ul>
<p>Most simply: ERP varies inversely with price: low price &lt;=&gt; high ERP (and vice-versa).</p>
<p>FF use three predictor variables:</p>
<ul class="simple">
<li><p><strong>DP = dividend yield on all NYSE stocks = Dividend/Price</strong></p></li>
</ul>
<blockquote>
<div><p>Since dividends on all stocks are fairly constant, DP is inversely related to the index price level.
So, low prices =&gt; high DP =&gt; high expected returns.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>DEF = AllLTYld - AaaLTYld</strong></p></li>
</ul>
<blockquote>
<div><p>the yield on a portfolio of 100 (government (riskless) and corporate (risky)) long-term maturity bonds - the yield on a portfolio of long-term low-risk (Aaa rated) bonds.</p>
</div></blockquote>
<blockquote>
<div><p>Since there is default risk in the AllLTYld but none in the AaaLTYld, DEF is the default (or credit) spread. Low prices for risky bonds means high risky bond yields, which means a high DEF. But, low junk bond prices mean high expected returns on junk bonds (and, it is hypothesized, on stock returns as well).</p>
</div></blockquote>
<blockquote>
<div><p>So, high DEF =&gt; high expected returns.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>TERM = AaaLTYld - TBillYld</strong></p></li>
</ul>
<blockquote>
<div><p>the yield on a long-term riskless bond portfolio minus the yield on a short-term riskless bond portfolio.</p>
</div></blockquote>
<blockquote>
<div><p>This is called the “term spread” and represents the slope of the yield curve. Empirically, a steep yield curve (a high TERM) occurs at economic troughs; expected returns are higher at economic troughs. And, at economic peaks, the yield curve is flat or sometimes even inverted; economic peaks feature low expected returns.</p>
</div></blockquote>
<blockquote>
<div><p>Thus, high TERM =&gt; high expected returns.</p>
</div></blockquote>
<p>An important aspect of the FF study is that they investigate if the predictor model predicts subsequent (a) monthly returns, or (b) quarterly returns or © annual returns or (d) 4-year returns. This helps us confirm whether the contrarian TAA hypothesis of long-term mean reversion in stock index returns applies.</p>
<p>FF look at predicting the returns on 4 asset classes:</p>
<ul class="simple">
<li><p>Aaa = long-term riskless bonds</p></li>
<li><p>LG = long-term, low-grade, i.e., risky bonds</p></li>
<li><p>VW = a value-weighted stock portfolio, i.e., a big-cap stock portfolio</p></li>
<li><p>EW = an equally-weighted stock portfolio, i.e., a small-cap stock portfolio.</p></li>
</ul>
<p>Thus, FF investigates if the three predictor variables, DP, DEF and TERM, have any predictive power in forecasting the future returns on 4 asset classes: Aaa, LG, VW and EW. These four asset classes have very different return profiles, so we would expect different levels of predictive acuracies among the predictor variables.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<section id="taa-fama-french-results">
<h2>TAA: Fama-French Results<a class="headerlink" href="#taa-fama-french-results" title="Permalink to this heading">#</a></h2>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Now we load historical data and take a look at patterns of FF risk factors. First we load packages that we need for our analysis.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Here we load data. The data includes Fama-French risk factors, factors for Chen predictive models, and asset returns</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">riskfactors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;riskfactors_V2.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>We now take a look at the data structure.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">riskfactors</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dp</th>
      <th>term</th>
      <th>def</th>
      <th>ypl</th>
      <th>tb30</th>
      <th>CRSP_SPvwx</th>
      <th>realgnpg</th>
      <th>mktrf</th>
      <th>Rfree</th>
      <th>AAA</th>
      <th>BAA</th>
      <th>vwretx</th>
      <th>ewretx</th>
      <th>corpr</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1941-02-28</th>
      <td>6.821573</td>
      <td>2.74</td>
      <td>4.636888</td>
      <td>NaN</td>
      <td>0.0004</td>
      <td>-0.012570</td>
      <td>NaN</td>
      <td>-0.013640</td>
      <td>-0.0001</td>
      <td>0.0278</td>
      <td>0.0442</td>
      <td>-0.038958</td>
      <td>-0.013340</td>
      <td>0.0006</td>
    </tr>
    <tr>
      <th>1941-03-31</th>
      <td>6.827309</td>
      <td>2.69</td>
      <td>4.474293</td>
      <td>NaN</td>
      <td>0.0011</td>
      <td>0.004173</td>
      <td>NaN</td>
      <td>0.003978</td>
      <td>0.0001</td>
      <td>0.0280</td>
      <td>0.0438</td>
      <td>-0.013024</td>
      <td>-0.027249</td>
      <td>-0.0022</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###########################################</span>
<span class="c1">###An overview of variables in the dataset</span>
<span class="c1">###########################################</span>

<span class="c1">#! dp: Dividend price ratio on NYSE stock index (source: Goyal&#39;s website)</span>
<span class="c1">#! def: default yield spread: yield of BAA - AAA bond yield (source: Goyal&#39;s website)</span>
<span class="c1">#! term: term spread: AAA yield - 30day treasury bill (source: Goyal&#39;s website &amp; Fama-Frenc(1989))</span>
<span class="c1">#! ypl: annual growth in industrial production (source: FRED)</span>
<span class="c1">#! tb30: 30day treasury bill yield (source: Goyal&#39;s website)</span>
<span class="c1">#! CRSP_SPvwx: SP500 value weighted index return (source: Goyal&#39;s website)</span>
<span class="c1">#! realgnpg: quarterly real GNP growth (source: FRED)</span>
<span class="c1">#! mktrf: market premium (source: Goyal&#39;s website)</span>
<span class="c1">#! Rfree: risk free rate (source: Goyal&#39;s website)</span>
<span class="c1">#! AAA: AAA bond yield (source: Goyal&#39;s website)</span>
<span class="c1">#! BBB: BBB bond yield (source: Goyal&#39;s website)</span>
<span class="c1">#! vwretx: value weighted return of all stocks (source: WRDS)</span>
<span class="c1">#! ewretx: equal weighted return of all stocks (source: WRDS)</span>
<span class="c1">#! corpr: corporate bond returns (source: Goyal&#39;s website)</span>

<span class="c1"># Goyal&#39;s website: https://sites.google.com/view/agoyal145/?redirpath=/</span>

<span class="nb">list</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;dp&#39;,
 &#39;term&#39;,
 &#39;def&#39;,
 &#39;ypl&#39;,
 &#39;tb30&#39;,
 &#39;CRSP_SPvwx&#39;,
 &#39;realgnpg&#39;,
 &#39;mktrf&#39;,
 &#39;Rfree&#39;,
 &#39;AAA&#39;,
 &#39;BAA&#39;,
 &#39;vwretx&#39;,
 &#39;ewretx&#39;,
 &#39;corpr&#39;]
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>As a sanity check, let’s take a look at the dividend-price ratio over time.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check how the dp ratio looks like over time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>   
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>  

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dividend Price Ratio Over Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>   
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>   
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;DP Ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>   

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>   
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>  

<span class="c1"># Remove the top and right spines to reduce visual clutter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Adjust tick parameters for a cleaner look</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust the layout to make sure everything fits without overlap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Display the plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/835661d5eb0b819205f8fefb01fd21ea957da54007077b13506ef71d8088cef0.png" src="_images/835661d5eb0b819205f8fefb01fd21ea957da54007077b13506ef71d8088cef0.png" />
</div>
</div>
<div class="custom-container">
<p>We plot the FF risk factors to take a look at their distribution.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot DP</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">dp</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DP&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dividend-price ratio&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DP&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Format the dates on x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="c1"># Reference line at y=1</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Plot a maximum of 10 ticks on the x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df66ab3af50017c3aae90e020e9aa761f7d90875300f043b4b5192410665a485.png" src="_images/df66ab3af50017c3aae90e020e9aa761f7d90875300f043b4b5192410665a485.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot DEF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">],</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEF&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Default Spread&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DEF&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Format the dates on x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="c1"># Reference line at y=0</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Plot a maximum of 10 ticks on the x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/32a0dbbd3bcd8005ce22ee3ab77392e3a10c9ca13c17bcdab74b5b3c96d13ece.png" src="_images/32a0dbbd3bcd8005ce22ee3ab77392e3a10c9ca13c17bcdab74b5b3c96d13ece.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot TERM</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TERM&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Term Spread&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;TERM&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Format the dates on x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="c1"># Reference line at y=0</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Plot a maximum of 10 ticks on the x-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0b862f82c4f2e1609028f603e8cf6b61bf4175b58557fa3702663739e51a3f14.png" src="_images/0b862f82c4f2e1609028f603e8cf6b61bf4175b58557fa3702663739e51a3f14.png" />
</div>
</div>
<div class="custom-container">
<p>Now we use the data to understand the Fama French multi-risk factor results and asset return prediction.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-1">
<h2>Fama-French Paper Result 1<a class="headerlink" href="#fama-french-paper-result-1" title="Permalink to this heading">#</a></h2>
<p><strong>DP and DEF are persistent, TERM is not.</strong></p>
<ul class="simple">
<li><p>Both DP and DEF are <em>autocorrelated with lags</em>. This means that <span class="math notranslate nohighlight">\(Corr(𝐷P_{𝑡} ,𝐷P_{𝑡 +1})&gt;0\)</span>, but so is <span class="math notranslate nohighlight">\(Corr(𝐷P_{𝑡} ,𝐷P_{𝑡 +2})&gt;0\)</span>, and so is <span class="math notranslate nohighlight">\(Corr(𝐷P_{𝑡} ,𝐷P_{𝑡 +3})&gt;0\)</span>, etc., out to 8 annual lags.</p></li>
<li><p>Same with DEF. This means that when DP or DEF are above/below their means, they tend to stay there for quite a while.</p></li>
<li><p>TERM has positive autocorrelation, but only out to 2 annual lags.</p></li>
<li><p>Another interpretation: DP and DEF have long frequencies, TERM has a short frequency.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Now we simulate the results using data. We firstly select the sample period to 1941 - 1987 (1941 is the year that the data sample starts, 1987 is the end year of Fama French paper)</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Below we filter the risk factors to the period of interest</span>
<span class="n">start_period</span> <span class="o">=</span> <span class="s1">&#39;1941&#39;</span>
<span class="n">end_period</span> <span class="o">=</span> <span class="s1">&#39;1987&#39;</span>
<span class="n">riskfactors_filtered</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="n">start_period</span><span class="p">:</span><span class="n">end_period</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>Now we print the autocorrelation for DP, DEF, and TERM to look at the persistence of these risk factors.</p>
<p>Moreover, we are going to use this occasion to learn how to define a Python function to calculate the autocorrelation. When you define a function, you can use it multiple times without having to write the same code over and over again :)</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Autocorrelation function </span>
<span class="k">def</span> <span class="nf">autocorr</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">correlations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">t, </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">t+</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="mi">12</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">correlations</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Lag&#39;</span><span class="p">,</span> <span class="s1">&#39;Correlation&#39;</span><span class="p">],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;fancy_grid&#39;</span><span class="p">))</span>

<span class="c1"># DP autocorrelation for future periods</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DP is highly persistent&quot;</span><span class="p">)</span>
<span class="n">autocorr</span><span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;DP&#39;</span><span class="p">)</span>

<span class="c1"># DEF autocorrelation for future periods</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEF is persistent&quot;</span><span class="p">)</span>
<span class="n">autocorr</span><span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;DEF&#39;</span><span class="p">)</span>

<span class="c1"># TERM autocorrelation for future periods</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TERM is less persistent&quot;</span><span class="p">)</span>
<span class="n">autocorr</span><span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;TERM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DP is highly persistent
╒════════════╤═══════════════╕
│ Lag        │   Correlation │
╞════════════╪═══════════════╡
│ DPt, DPt+1 │          0.8  │
├────────────┼───────────────┤
│ DPt, DPt+2 │          0.65 │
├────────────┼───────────────┤
│ DPt, DPt+3 │          0.59 │
├────────────┼───────────────┤
│ DPt, DPt+4 │          0.51 │
╘════════════╧═══════════════╛
DEF is persistent
╒══════════════╤═══════════════╕
│ Lag          │   Correlation │
╞══════════════╪═══════════════╡
│ DEFt, DEFt+1 │          0.67 │
├──────────────┼───────────────┤
│ DEFt, DEFt+2 │          0.54 │
├──────────────┼───────────────┤
│ DEFt, DEFt+3 │          0.51 │
├──────────────┼───────────────┤
│ DEFt, DEFt+4 │          0.61 │
╘══════════════╧═══════════════╛
TERM is less persistent
╒════════════════╤═══════════════╕
│ Lag            │   Correlation │
╞════════════════╪═══════════════╡
│ TERMt, TERMt+1 │          0.52 │
├────────────────┼───────────────┤
│ TERMt, TERMt+2 │          0.18 │
├────────────────┼───────────────┤
│ TERMt, TERMt+3 │          0.02 │
├────────────────┼───────────────┤
│ TERMt, TERMt+4 │          0.06 │
╘════════════════╧═══════════════╛
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>Next we move to Result 2 to understand how Fama French Risk Factors move with Business Cycles.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-2">
<h2>Fama-French Paper Result 2<a class="headerlink" href="#fama-french-paper-result-2" title="Permalink to this heading">#</a></h2>
<p>After 1951, TERM is higher at the trough of a business cycle compared to its levels at both the preceding peak and the subsequent peak of the business cycle.</p>
<ul class="simple">
<li><p>While TERM has lower autocorrelation than DP or DEF, it is typically steep at business cycle troughs and flat (or inverted) at business cycle peaks.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The code below plots the risk factors and business cycles.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define start and end period</span>
<span class="n">start_period</span> <span class="o">=</span> <span class="mi">1941</span>
<span class="n">end_period</span> <span class="o">=</span> <span class="mi">2023</span>

<span class="c1"># Read and prepare US recession data</span>
<span class="n">csv_usrec</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/lorenzogarlappi/COMM475/main/Data/usrec_quarterly.csv&#39;</span>
<span class="n">rec_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_usrec</span><span class="p">)</span>

<span class="c1"># Correct date conversion approach</span>
<span class="n">rec_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">rec_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> 
                                  <span class="p">((</span><span class="n">rec_data</span><span class="p">[</span><span class="s1">&#39;quarter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> 
                                  <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>

<span class="c1"># Filter rec_data within the specified period</span>
<span class="n">rec_data_filtered</span> <span class="o">=</span> <span class="n">rec_data</span><span class="p">[(</span><span class="n">rec_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_period</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rec_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_period</span><span class="p">)]</span>

<span class="c1"># Plot TERM over time, highlighting US recession periods</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TERM&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Shading for recession periods</span>
<span class="k">for</span> <span class="n">start_date</span> <span class="ow">in</span> <span class="n">rec_data_filtered</span><span class="p">[</span><span class="n">rec_data_filtered</span><span class="p">[</span><span class="s1">&#39;usrec&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;1951-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;1988-01-01&#39;</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;TERM and US Recession Periods (1951-1987)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;TERM&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d0337c32c42b631e9ab487b3e4f1b621203ba460471c0908d99b1b26bfa2e993.png" src="_images/d0337c32c42b631e9ab487b3e4f1b621203ba460471c0908d99b1b26bfa2e993.png" />
</div>
</div>
<div class="custom-container">
<p>Now we move to Result 3 to understand the correlation among FF risk factors.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-3">
<h2>Fama-French Paper Result 3<a class="headerlink" href="#fama-french-paper-result-3" title="Permalink to this heading">#</a></h2>
<p>Correlations:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Corr(𝐷P_{𝑡} ,𝐷EF_{𝑡})=0.75\)</span>: DP and DEF move together over time.</p></li>
</ul>
<p><strong>Obs.</strong>: Our results below show a weaker correlation, probably because our DP calculation differs from that in FF (1989). We don’t weight dividends by market cap in the numerator, a method they use. To replicate their approach accurately, we’d need to pinpoint dividend-paying firms and assess their market cap at dividend announcement, a notably cumbersome task.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Corr(𝐷P_{𝑡} ,TERM_{𝑡})=0.16\)</span>, and <span class="math notranslate nohighlight">\(Corr(𝐷EF_{𝑡} ,TERM_{𝑡})=0.18\)</span>.</p>
<ul>
<li><p>TERM behaves differently than DP and DEF.</p></li>
<li><p>DP and DEF have similar characteristics overtime, but TERM is quite different from DP and DEF.</p></li>
</ul>
</li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The code below plots DP, TERM, and DEF. The graph shows that TERM is much more volatile than DP and DEF.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span>
<span class="n">dp</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span>   
<span class="n">term</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span>
<span class="n">default</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span>   

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0173B2&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TERM&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#DE8F05&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEF&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#029E73&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DP&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Add reference line at zero</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Configurations</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Risk Factors Over Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4fe5fd9fe312ec16dda6258e8ec774a8f11e714263ad74eb3274de40e4153d51.png" src="_images/4fe5fd9fe312ec16dda6258e8ec774a8f11e714263ad74eb3274de40e4153d51.png" />
</div>
</div>
<div class="custom-container">
<p>Now let’s check the correlation between the risk factors decade-by-decade.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the decades</span>
<span class="n">decades</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;40s&#39;</span><span class="p">,</span> <span class="s1">&#39;50s&#39;</span><span class="p">,</span> <span class="s1">&#39;60s&#39;</span><span class="p">,</span> <span class="s1">&#39;70s&#39;</span><span class="p">,</span> <span class="s1">&#39;80s&#39;</span><span class="p">,</span> <span class="s1">&#39;90s&#39;</span><span class="p">,</span> <span class="s1">&#39;2000s&#39;</span><span class="p">,</span> <span class="s1">&#39;2010s&#39;</span><span class="p">,</span> <span class="s1">&#39;2020s&#39;</span><span class="p">,</span> <span class="s1">&#39;41-87&#39;</span><span class="p">]</span>
<span class="n">time_ranges</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;40s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1941-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1949-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;50s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1950-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1959-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;60s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1969-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;70s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1979-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;80s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1980-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1989-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;90s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1990-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1999-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;2000s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2009-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;2010s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2010-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;2020s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-12-31&#39;</span><span class="p">),</span>
    <span class="s1">&#39;41-87&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1941-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1987-12-31&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Prepare the data structure for correlations</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DP and DEF&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;DP and TERM&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;DEF and TERM&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="c1"># Calculate correlations for each decade</span>
<span class="k">for</span> <span class="n">decade</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">time_ranges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">correlations</span><span class="p">[</span><span class="s2">&quot;DP and DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]))</span>
    <span class="n">correlations</span><span class="p">[</span><span class="s2">&quot;DP and TERM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]))</span>
    <span class="n">correlations</span><span class="p">[</span><span class="s2">&quot;DEF and TERM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]))</span>

<span class="c1"># Convert correlations to a format suitable for tabulation</span>
<span class="n">correlations_for_table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">correlations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span>
    <span class="n">correlations_for_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="c1"># Print the table with decades as columns</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Factor Pair&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">decades</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">correlations_for_table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------------+-------+-------+-------+-------+-------+-------+---------+---------+---------+---------+
| Factor Pair   |   40s |   50s |   60s |   70s |   80s |   90s |   2000s |   2010s |   2020s |   41-87 |
+===============+=======+=======+=======+=======+=======+=======+=========+=========+=========+=========+
| DP and DEF    |  0.69 |  0.29 |  0.45 | -0.23 |  0.32 |  0.05 |    0.92 |    0.55 |    0.66 |    0.61 |
+---------------+-------+-------+-------+-------+-------+-------+---------+---------+---------+---------+
| DP and TERM   |  0.11 |  0.21 | -0.01 | -0.37 | -0.19 |  0.43 |    0.37 |    0.14 |   -0.41 |    0.06 |
+---------------+-------+-------+-------+-------+-------+-------+---------+---------+---------+---------+
| DEF and TERM  |  0.68 |  0.46 |  0.70 |  0.59 |  0.12 | -0.01 |    0.47 |   -0.27 |   -0.07 |    0.24 |
+---------------+-------+-------+-------+-------+-------+-------+---------+---------+---------+---------+
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>Next we move to Result 4 to study the predictability of Fama French risk factors on asset returns.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-4">
<h2>Fama-French Paper Result 4<a class="headerlink" href="#fama-french-paper-result-4" title="Permalink to this heading">#</a></h2>
<p>In their analysis, Fama and French regress asset class returns (Aaa, LG, VW, and EW) against predictor variables (DP, DEF, and TERM), observing:</p>
<ul class="simple">
<li><p>Most b and c regression coefficients are positive, aligning with expectations.</p></li>
<li><p>For risky assets (LG, VW, and EW), with increasing return horizons, DP and DEF exhibit rising t-stats, whereas TERM’s t-stats diminish, indicating reduced predictive power over longer horizons.</p></li>
</ul>
<p>The model can be expressed as:</p>
<div class="math notranslate nohighlight">
\[
r_i - r_f = \alpha + \beta_1 \cdot PV_{1} + \beta_2 \cdot PV_{2} + \epsilon
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_i\)</span>: the return of asset <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(r_f\)</span>: the risk-free rate. We use the 1-month Treasury bill rate as a proxy for the risk-free rate.</p></li>
<li><p><span class="math notranslate nohighlight">\(alpha\)</span>: the intercept. If the model is good at capturing systematic risk, we should not be able to reject <span class="math notranslate nohighlight">\(\hat{\alpha}=0\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(PV_{1}, PV_{2}\)</span>: predictors.</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_1, \beta_2\)</span>: coefficients we want to estimate.</p></li>
<li><p><span class="math notranslate nohighlight">\(\epsilon\)</span>: the error term, capturing the variation in excess returns not explained by the predictive variables.</p></li>
</ul>
<p>Due to the high correlation observed between <span class="math notranslate nohighlight">\(dp\)</span> (dividend price ratio) and <span class="math notranslate nohighlight">\(def\)</span> (default spread) during the period 1941-1987, a direct multivariate regression including both as predictors might lead to multicollinearity, obscuring the interpretation of their individual effects on asset returns. To deal with this, Fama and French propose separate regressions:</p>
<ol class="arabic">
<li><p><strong>First Specification</strong>:</p>
<div class="math notranslate nohighlight">
\[
   r_i - r_f = \alpha + \beta_1 \cdot dp + \beta_2 \cdot term + \epsilon
   \]</div>
<p>This specification includes <span class="math notranslate nohighlight">\(dp\)</span> and <span class="math notranslate nohighlight">\(term\)</span>, excluding <span class="math notranslate nohighlight">\(def\)</span>.</p>
</li>
<li><p><strong>Second Specification</strong>:</p>
<div class="math notranslate nohighlight">
\[
   r_i - r_f = \alpha + \beta_1 \cdot def + \beta_2 \cdot term + \epsilon
   \]</div>
<p>In contrast, this model incorporates <span class="math notranslate nohighlight">\(def\)</span> and <span class="math notranslate nohighlight">\(term\)</span>, omitting <span class="math notranslate nohighlight">\(dp\)</span>.</p>
</li>
</ol>
<p><strong>Conclusions</strong>:</p>
<ul class="simple">
<li><p>DP and DEF emerge as stronger predictors of risky asset returns over longer horizons, while TERM’s predictive ability wanes. This finding corroborates Result 1, highlighting DP and DEF’s persistence and “long cycles”, suggesting their effectiveness in forecasting longer-term returns.</p></li>
<li><p>A high DP today implies a higher likelihood of above-average returns over the next four years (t-stat of 5.26, surpassing the conventional significance threshold of 1.96).</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Now we will take a stab at replicating FF(1989). In the code below, X represent the set of risk factors, and Y represents asset returns.</p>
<p>Due to the absence of differentiated risk class data for corporate returns, we use <code class="docutils literal notranslate"><span class="pre">corpr</span></code>, a composite portfolio of long-term corporate bonds (both high and low-grade), as our proxy. Additionally, we use value-weighted and equally-weighted stock returns in the LHS, constructed from CRSP data (detailed in the Appendix code).</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter to match the sample period in Fama-French 1989</span>
<span class="n">riskfactors_filtered</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;1941&#39;</span><span class="p">:</span><span class="s1">&#39;1987&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[[</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">]]</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Corp&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;corpr&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;VW&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;vwretx&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;EW&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;ewretx&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">]</span>  <span class="c1"># Specify your predictors here</span>

<span class="c1"># Define periods for non-overlapping observations</span>
<span class="n">periods</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;4Y&#39;</span><span class="p">:</span> <span class="mi">48</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">predictive_regression</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">predictors</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">periods</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run predictive regressions and return a DataFrame containing regression results including R^2.</span>

<span class="sd">    Args:</span>
<span class="sd">        X (pd.DataFrame): DataFrame containing predictor variables.</span>
<span class="sd">        Y (pd.Series): Series containing the outcome variable.</span>
<span class="sd">        predictors (list): List of predictor column names to include in the regression.</span>
<span class="sd">        periods (dict): Dictionary specifying the periods for regression.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing regression results with R^2 for each model and predictive horizon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X_lagged</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Lagging predictors by one period for predictability</span>

    <span class="k">for</span> <span class="n">period_name</span><span class="p">,</span> <span class="n">shift</span> <span class="ow">in</span> <span class="n">periods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Prepare Y based on the period</span>
        <span class="n">Y_shifted</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">shift</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period_name</span> <span class="o">!=</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
            <span class="n">Y_shifted</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">shift</span><span class="p">)</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_lagged</span><span class="p">,</span> <span class="n">Y_shifted</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">X_aligned</span><span class="p">,</span> <span class="n">Y_aligned</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">predictors</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y_aligned</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_aligned</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HAC&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxlags&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
        
        <span class="k">for</span> <span class="n">predictor</span> <span class="ow">in</span> <span class="n">predictors</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Interval&#39;</span><span class="p">:</span> <span class="n">period_name</span><span class="p">,</span>
                <span class="s1">&#39;Asset&#39;</span><span class="p">:</span> <span class="n">Y</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;Predictor&#39;</span><span class="p">:</span> <span class="n">predictor</span><span class="p">,</span>
                <span class="s1">&#39;Coefficient&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">predictor</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;T-Stat&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="n">predictor</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;R^2&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">rsquared</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">})</span>
            
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Execute the predictive regression for each asset and compile the results</span>
<span class="n">summary_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">asset_name</span>  <span class="c1"># Set the name property for identification</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">predictive_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">periods</span><span class="p">)</span>
    <span class="n">summary_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">summary_results</span><span class="p">,</span> <span class="n">results</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display the results DataFrame in a readable format</span>
<span class="n">display</span><span class="p">(</span><span class="n">summary_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Interval</th>
      <th>Asset</th>
      <th>Predictor</th>
      <th>Coefficient</th>
      <th>T-Stat</th>
      <th>R^2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>Corp</td>
      <td>dp</td>
      <td>0.07</td>
      <td>2.32</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.08</td>
      <td>1.55</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Q</td>
      <td>Corp</td>
      <td>dp</td>
      <td>0.20</td>
      <td>2.23</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Q</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.24</td>
      <td>1.53</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Y</td>
      <td>Corp</td>
      <td>dp</td>
      <td>0.76</td>
      <td>2.07</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Y</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.85</td>
      <td>1.35</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4Y</td>
      <td>Corp</td>
      <td>dp</td>
      <td>3.45</td>
      <td>2.53</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4Y</td>
      <td>Corp</td>
      <td>term</td>
      <td>1.46</td>
      <td>0.59</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>8</th>
      <td>M</td>
      <td>VW</td>
      <td>dp</td>
      <td>0.10</td>
      <td>2.94</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>9</th>
      <td>M</td>
      <td>VW</td>
      <td>term</td>
      <td>0.09</td>
      <td>1.73</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Q</td>
      <td>VW</td>
      <td>dp</td>
      <td>0.31</td>
      <td>3.12</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Q</td>
      <td>VW</td>
      <td>term</td>
      <td>0.27</td>
      <td>1.68</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Y</td>
      <td>VW</td>
      <td>dp</td>
      <td>1.31</td>
      <td>3.46</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Y</td>
      <td>VW</td>
      <td>term</td>
      <td>0.83</td>
      <td>1.27</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4Y</td>
      <td>VW</td>
      <td>dp</td>
      <td>4.91</td>
      <td>3.48</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>15</th>
      <td>4Y</td>
      <td>VW</td>
      <td>term</td>
      <td>1.50</td>
      <td>0.61</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>16</th>
      <td>M</td>
      <td>EW</td>
      <td>dp</td>
      <td>0.15</td>
      <td>2.81</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>17</th>
      <td>M</td>
      <td>EW</td>
      <td>term</td>
      <td>0.06</td>
      <td>0.76</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Q</td>
      <td>EW</td>
      <td>dp</td>
      <td>0.49</td>
      <td>3.09</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Q</td>
      <td>EW</td>
      <td>term</td>
      <td>0.17</td>
      <td>0.70</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Y</td>
      <td>EW</td>
      <td>dp</td>
      <td>2.15</td>
      <td>3.47</td>
      <td>0.13</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Y</td>
      <td>EW</td>
      <td>term</td>
      <td>0.29</td>
      <td>0.29</td>
      <td>0.13</td>
    </tr>
    <tr>
      <th>22</th>
      <td>4Y</td>
      <td>EW</td>
      <td>dp</td>
      <td>8.15</td>
      <td>3.52</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>23</th>
      <td>4Y</td>
      <td>EW</td>
      <td>term</td>
      <td>0.06</td>
      <td>0.02</td>
      <td>0.15</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="custom-container">
<ul class="simple">
<li><p>Results show that DP is a better predictor than TERM for corporate bond returns.</p></li>
<li><p>Next we look at the predictive power of risk factors DEF and TERM on asset returns.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[[</span><span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">]]</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">]</span>  <span class="c1"># Note that we did a great effort to define the function predictive_regression to be flexible. Now you can easily change the predictors: in this case we swap dp with def. </span>

<span class="n">summary_results_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">asset_name</span>
    <span class="n">results_def</span> <span class="o">=</span> <span class="n">predictive_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">periods</span><span class="p">)</span>
    <span class="n">summary_results_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">summary_results_def</span><span class="p">,</span> <span class="n">results_def</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">summary_results_def</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Interval</th>
      <th>Asset</th>
      <th>Predictor</th>
      <th>Coefficient</th>
      <th>T-Stat</th>
      <th>R^2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>Corp</td>
      <td>def</td>
      <td>0.28</td>
      <td>5.95</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.04</td>
      <td>0.90</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Q</td>
      <td>Corp</td>
      <td>def</td>
      <td>0.83</td>
      <td>5.91</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Q</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.12</td>
      <td>0.85</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Y</td>
      <td>Corp</td>
      <td>def</td>
      <td>3.34</td>
      <td>6.05</td>
      <td>0.35</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Y</td>
      <td>Corp</td>
      <td>term</td>
      <td>0.32</td>
      <td>0.61</td>
      <td>0.35</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4Y</td>
      <td>Corp</td>
      <td>def</td>
      <td>14.62</td>
      <td>6.09</td>
      <td>0.43</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4Y</td>
      <td>Corp</td>
      <td>term</td>
      <td>-1.88</td>
      <td>-0.90</td>
      <td>0.43</td>
    </tr>
    <tr>
      <th>8</th>
      <td>M</td>
      <td>VW</td>
      <td>def</td>
      <td>0.34</td>
      <td>4.39</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>9</th>
      <td>M</td>
      <td>VW</td>
      <td>term</td>
      <td>0.05</td>
      <td>1.01</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Q</td>
      <td>VW</td>
      <td>def</td>
      <td>1.01</td>
      <td>4.53</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Q</td>
      <td>VW</td>
      <td>term</td>
      <td>0.12</td>
      <td>0.92</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Y</td>
      <td>VW</td>
      <td>def</td>
      <td>3.91</td>
      <td>5.36</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Y</td>
      <td>VW</td>
      <td>term</td>
      <td>0.26</td>
      <td>0.47</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4Y</td>
      <td>VW</td>
      <td>def</td>
      <td>16.00</td>
      <td>7.15</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>15</th>
      <td>4Y</td>
      <td>VW</td>
      <td>term</td>
      <td>-1.98</td>
      <td>-0.98</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>16</th>
      <td>M</td>
      <td>EW</td>
      <td>def</td>
      <td>0.54</td>
      <td>5.07</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>17</th>
      <td>M</td>
      <td>EW</td>
      <td>term</td>
      <td>-0.02</td>
      <td>-0.26</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Q</td>
      <td>EW</td>
      <td>def</td>
      <td>1.61</td>
      <td>5.24</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Q</td>
      <td>EW</td>
      <td>term</td>
      <td>-0.07</td>
      <td>-0.35</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Y</td>
      <td>EW</td>
      <td>def</td>
      <td>6.31</td>
      <td>6.21</td>
      <td>0.39</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Y</td>
      <td>EW</td>
      <td>term</td>
      <td>-0.63</td>
      <td>-0.76</td>
      <td>0.39</td>
    </tr>
    <tr>
      <th>22</th>
      <td>4Y</td>
      <td>EW</td>
      <td>def</td>
      <td>25.00</td>
      <td>7.80</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>23</th>
      <td>4Y</td>
      <td>EW</td>
      <td>term</td>
      <td>-5.30</td>
      <td>-1.66</td>
      <td>0.47</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="custom-container">
<p>The regression results indicate that DEF could predict asset returns better than TERM for bond returns.</p>
<p>The prediction results together in this section indicate that DP and DEF are better predictors of bond returns than TERM.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Next we further study the prediction of FF risk factors on asset returns for longer periods.</p>
<p>Result 5, Result 6 and Result 7 need longer-horizon data.
Given that the data we used is on quarterly basis, we did not reproduce those results in python here. But these results could be generated with the sample code.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-5">
<h2>Fama-French Paper Result 5<a class="headerlink" href="#fama-french-paper-result-5" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>At 1-year and 4-year horizons: the DP and DEF coefficients increase when moving from LG to VW to EW, that is, as the risk of the asset class increases. TERM coefficients are not sensitive to the risk of the asset class. In our data, we have a portfolio of long-term corporate bond returns (corpr) that mixes high-grade and low-grade bonds. We will use this as a proxy to test the FF1989 results.</p></li>
<li><p>Recall that from the exercises above replicating Result 4, we can recover the coefficient estimators and T-statistics. Below we will used them to create a visual representation of FF(1989) Result 5.</p></li>
</ul>
<p><strong>Conclusion from Result 5</strong>:</p>
<p>DP and DEF are better predictors for riskier assets; TERM’s power to predict does not depend on the asset’s risk.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert &#39;Coefficient&#39; and &#39;T-Stat&#39; columns from object to float for calculations</span>
<span class="n">summary_results</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_results</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">summary_results</span><span class="p">[</span><span class="s1">&#39;T-Stat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_results</span><span class="p">[</span><span class="s1">&#39;T-Stat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">summary_results_def</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_results_def</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">summary_results_def</span><span class="p">[</span><span class="s1">&#39;T-Stat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_results_def</span><span class="p">[</span><span class="s1">&#39;T-Stat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Combine the two DataFrames</span>
<span class="n">combined_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">summary_results</span><span class="p">,</span> <span class="n">summary_results_def</span><span class="p">])</span>

<span class="c1"># Filter for yearly data</span>
<span class="n">yearly_data</span> <span class="o">=</span> <span class="n">combined_results</span><span class="p">[</span><span class="n">combined_results</span><span class="p">[</span><span class="s1">&#39;Interval&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the CI</span>
<span class="n">yearly_data</span><span class="p">[</span><span class="s1">&#39;CI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">yearly_data</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">yearly_data</span><span class="p">[</span><span class="s1">&#39;T-Stat&#39;</span><span class="p">]</span>

<span class="c1"># Eliminate duplicate entries of &#39;term&#39; predictor. Keep only the first. </span>
<span class="n">yearly_data</span> <span class="o">=</span> <span class="n">yearly_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="s1">&#39;Predictor&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="c1"># Setting up the plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Create a point plot with non-overlapping points for each predictor within each asset</span>
<span class="c1"># Adjust the position based on the predictor to avoid overlap</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">yearly_data</span><span class="p">[</span><span class="s1">&#39;Predictor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">yearly_data</span><span class="p">[</span><span class="s1">&#39;Asset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">asset_positions</span> <span class="o">=</span> <span class="p">{</span><span class="n">asset</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">assets</span><span class="p">)}</span>
<span class="n">predictor_offsets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dp&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">yearly_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">asset_positions</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Asset&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">predictor_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Predictor&#39;</span><span class="p">]]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Predictor&#39;</span><span class="p">])]</span>
    
    <span class="c1"># Plot point</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Predictor&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># Plot error bar</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CI&#39;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Customize the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Coefficients Estimators (T=1 year) and 95% CIs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Create a custom legend</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>  <span class="c1"># Remove duplicates</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Predictor&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dc0350ae70e1ec99e91b47333acea06739009a42a6fed14cd63de6140c071618.png" src="_images/dc0350ae70e1ec99e91b47333acea06739009a42a6fed14cd63de6140c071618.png" />
</div>
</div>
<div class="custom-container">
</section>
<section id="fama-french-paper-result-6">
<h2>Fama-French Paper Result 6<a class="headerlink" href="#fama-french-paper-result-6" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>At 1-year and 4-year horizons: the TERM coefficients are about 3 for the bond assets (Aaa, LG) and smaller (or negative!) for stocks (VW, EW).</p></li>
</ul>
<p><strong>Conclusion from Result 6</strong>:</p>
<p>TERM predicts similarly for riskless (Aaa) bonds and for risky (LG) bonds. Thus, TERM does not seem to depend upon asset class risk. From its definition, TERM is obviously more related to the level of interest rates. TERM is less helpful in predicting stock returns.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="fama-french-paper-result-7">
<h2>Fama-French Paper Result 7<a class="headerlink" href="#fama-french-paper-result-7" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The R-squared for the regressions at 1-year and 4-year horizons are quite good: this simple model has some predictive content for longer-horizon stock (and bond) returns.</p></li>
<li><p>FF also did “out-of-sample” tests. They fit the model with data from 1941 to 1971, then tested the model on data from 1972 to 1987. We will replicate this exercise in the code below.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_predictive_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">training_period</span><span class="p">,</span> <span class="n">testing_period</span><span class="p">,</span> <span class="n">periods</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate plots illustrating the in-sample and out-of-sample predictive regression R^2 values</span>
<span class="sd">    for each asset.</span>

<span class="sd">    Args:</span>
<span class="sd">        X (pd.DataFrame): DataFrame containing predictor variables.</span>
<span class="sd">        assets (dict): Dictionary with keys as asset names and values as pd.Series of asset returns.</span>
<span class="sd">        predictors (list): List of predictor column names to include in the regression.</span>
<span class="sd">        training_period (tuple): Start and end years for the training period.</span>
<span class="sd">        testing_period (tuple): Start and end years for the testing period.</span>
<span class="sd">        periods (dict): Dictionary specifying the periods for regression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">training_start</span><span class="p">,</span> <span class="n">training_end</span> <span class="o">=</span> <span class="n">training_period</span>
    <span class="n">testing_start</span><span class="p">,</span> <span class="n">testing_end</span> <span class="o">=</span> <span class="n">testing_period</span>

    <span class="k">for</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">Y_train</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">training_start</span><span class="p">:</span><span class="n">training_end</span><span class="p">]</span>
        <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">testing_start</span><span class="p">:</span><span class="n">testing_end</span><span class="p">]</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">training_start</span><span class="p">:</span><span class="n">training_end</span><span class="p">]</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">testing_start</span><span class="p">:</span><span class="n">testing_end</span><span class="p">]</span>

        <span class="c1"># Running predictive regression for the training period</span>
        <span class="n">train_results</span> <span class="o">=</span> <span class="n">predictive_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">periods</span><span class="p">)</span>
        <span class="n">test_results</span> <span class="o">=</span> <span class="n">predictive_regression</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">periods</span><span class="p">)</span>

        <span class="c1"># Assuming the focus is on annual (&#39;Y&#39;) predictions for simplicity in visualization</span>
        <span class="n">r2_train</span> <span class="o">=</span> <span class="n">train_results</span><span class="p">[</span><span class="n">train_results</span><span class="p">[</span><span class="s1">&#39;Interval&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="s1">&#39;R^2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">r2_test</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;Interval&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="s1">&#39;R^2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s1">&#39;In-Sample (1941-1971)&#39;</span><span class="p">,</span> <span class="s1">&#39;Out-of-Sample (1972-1987)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">r2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="s1">&#39;salmon&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">asset_name</span><span class="si">}</span><span class="s1"> - Predictive Regression R^2 Comparison&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average R^2 Value&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Assuming R^2 values are normalized</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Define the training and testing periods</span>
<span class="n">training_period</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1941&#39;</span><span class="p">,</span> <span class="s1">&#39;1971&#39;</span><span class="p">)</span>
<span class="n">testing_period</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1972&#39;</span><span class="p">,</span> <span class="s1">&#39;1987&#39;</span><span class="p">)</span>

<span class="c1"># Execute the plotting function</span>
<span class="n">plot_predictive_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">training_period</span><span class="p">,</span> <span class="n">testing_period</span><span class="p">,</span> <span class="n">periods</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/86ed00c9ac7952c245f7611b84704e8e8460d1fc25d3e64693f17737cb468ce1.png" src="_images/86ed00c9ac7952c245f7611b84704e8e8460d1fc25d3e64693f17737cb468ce1.png" />
<img alt="_images/9cca41180df61fa915c8f410ae39cdace05cf06cabc086797b06283aedf44ca0.png" src="_images/9cca41180df61fa915c8f410ae39cdace05cf06cabc086797b06283aedf44ca0.png" />
<img alt="_images/b3c41da45dbd63e12cf0e0148a4f688598fe94dce2ea8934025f8bfadd8d5924.png" src="_images/b3c41da45dbd63e12cf0e0148a4f688598fe94dce2ea8934025f8bfadd8d5924.png" />
</div>
</div>
<div class="custom-container">
</section>
<section id="fama-french-paper-result-7-cont">
<h2>Fama-French Paper Result 7 (cont.)<a class="headerlink" href="#fama-french-paper-result-7-cont" title="Permalink to this heading">#</a></h2>
<p>The results above are quite close to the FF(1989). We can interpret that, for such a simple model, an R-squared of .3 or .4 is pretty good.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-chen-predictive-model">
<h1>4. TAA: Chen Predictive Model<a class="headerlink" href="#taa-chen-predictive-model" title="Permalink to this heading">#</a></h1>
<p>In this section we first report the original results from Chen’s analysis and then reproduce the results with updated data.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<section id="chens-original-analysis">
<h2>Chen’s original analysis<a class="headerlink" href="#chens-original-analysis" title="Permalink to this heading">#</a></h2>
<p>Chen relates predictor variables to both the equity risk premium (ERP), as done by FF, but more importantly, he also relates the predictor variables to the <strong>business cycle</strong>. He finds that:</p>
<ul class="simple">
<li><p>The business cycle is related to the predictor variables and</p></li>
<li><p>Predictor variables are related to the ERP (as found by both Chen and FF)</p></li>
<li><p>Therefore, the business cycle and the ERP are related.</p></li>
</ul>
<p>Regarding the business cycle, Chen hypothesizes:</p>
<p>At a business cycle trough (and vice-versa at a peak):</p>
<ul class="simple">
<li><p>Future GNP growth is expected to be high</p></li>
<li><p>Short-term interest rates are low and the yield curve is steep</p></li>
</ul>
<p>At a business cycle peak (and vice-versa at a trough):</p>
<ul class="simple">
<li><p>Past GNP growth has been high</p></li>
<li><p>Stock and risky bond prices are high</p></li>
<li><p>Recent industrial production has been high</p></li>
</ul>
<p>Chen’s empirical results confirm:</p>
<ul class="simple">
<li><p>Interest rates are forward-looking predictors of business activity and ERP</p></li>
<li><p>Dividend yield (DP) and default spread (DEF) are price level proxies that reflect historical (previous) macroeconomic growth as well as high recent returns on stocks and risky bonds</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="an-overview-of-risk-factors-used-in-the-chen-predictive-model">
<h2>An Overview of Risk Factors Used in the Chen Predictive Model<a class="headerlink" href="#an-overview-of-risk-factors-used-in-the-chen-predictive-model" title="Permalink to this heading">#</a></h2>
<p>Quarterly data 1954-1986</p>
<section id="predictor-variables">
<h3>Predictor Variables<a class="headerlink" href="#predictor-variables" title="Permalink to this heading">#</a></h3>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div align="center">
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Predictor Variables</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(YPL_{t-1}\)</span></p></td>
<td><p>Annual growth in industrial production</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(UTS_{t-1}\)</span></p></td>
<td><p>10 year Government bond yield - 30-day T-Bill yield</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(TB_{t-1}\)</span></p></td>
<td><p>30-day T-Bill yield</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(URP_{t-1}\)</span></p></td>
<td><p>10 year all-corp bond yield - 10 year Aaa bond yield</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(DP_{t-1}\)</span></p></td>
<td><p>Dividend yield on NYSE stocks</p></td>
</tr>
</tbody>
</table>
</div><p>UTS follows the same definition as TERM in Fama French model; URP follows the same definition as DEF in Fama French model.</p>
<div align="center">
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Macroeconomic variables</p></th>
<th class="head"><p>Decription</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(GNPG_{t}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\log [G N P(t) / G N P(t-1)]\)</span>, or quarterly GNP growth</p></td>
</tr>
</tbody>
</table>
</div><p>Chen also includes real consumption per capita, which we will omit for now due to data unavailability.</p>
<div align="center">
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Market return variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(EVW_{t}\)</span></p></td>
<td><p>Value-weighted NYSE stock portfolio - 30-day T-Bill yield</p></td>
</tr>
</tbody>
</table>
</div><div class="custom-container">
</section>
<section id="the-predictivity-of-risk-factors-on-evw-t-is-as-follows">
<h3>The predictivity of risk factors on <span class="math notranslate nohighlight">\(EVW_{t}\)</span> is as follows:<a class="headerlink" href="#the-predictivity-of-risk-factors-on-evw-t-is-as-follows" title="Permalink to this heading">#</a></h3>
<p><strong>source: Chen 1991 Table 3 -lag1 (p536)</strong></p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div align="center">
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>State variable <span class="math notranslate nohighlight">\((X)\)</span></p></th>
<th class="head"><p>b</p></th>
<th class="head"><p>t-stat</p></th>
<th class="head"><p>R-square</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>YPL</p></td>
<td><p>-0.32</p></td>
<td><p>-2.75</p></td>
<td><p>6%</p></td>
</tr>
<tr class="row-odd"><td><p>URP</p></td>
<td><p>5.58</p></td>
<td><p>2.22</p></td>
<td><p>3%</p></td>
</tr>
<tr class="row-even"><td><p>DP</p></td>
<td><p>2.13</p></td>
<td><p>2.86</p></td>
<td><p>4%</p></td>
</tr>
<tr class="row-odd"><td><p>UTS</p></td>
<td><p>1.86</p></td>
<td><p>2.85</p></td>
<td><p>8%</p></td>
</tr>
<tr class="row-even"><td><p>TB</p></td>
<td><p>-0.47</p></td>
<td><p>-2.14</p></td>
<td><p>3%</p></td>
</tr>
</tbody>
</table>
</div><div class="custom-container">
</section>
<section id="results-on-risk-factors">
<h3>Results on risk factors:<a class="headerlink" href="#results-on-risk-factors" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>DP, UTS and URP results are the same as prediction in Fama-French.</p></li>
<li><p><strong>High</strong> YPL implies <strong>Low</strong> equity risk premium: industrial production growth is the highest at business cycle peaks, when stock prices are unusually high implies investors expect a slower stock market growth rate in the future.</p></li>
<li><p><strong>High</strong> TB implies <strong>Low</strong> equity risk premium: short term interest rates are the highest at business cycle peaks, when stock prices are unusually high implies investors expect a slower stock market growth rate in the future.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section id="predictivity-of-risk-factors-on-the-growth-rate-of-gnp-is-as-follows">
<h3>Predictivity of risk factors on the growth rate of GNP is as follows:<a class="headerlink" href="#predictivity-of-risk-factors-on-the-growth-rate-of-gnp-is-as-follows" title="Permalink to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[GNPG_{t+lead} = a + b*X_{t-1} + e_{t}\]</div>
<section id="source-chen1991-table-4-p538">
<h4>source: Chen1991 Table 4 (p538)<a class="headerlink" href="#source-chen1991-table-4-p538" title="Permalink to this heading">#</a></h4>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div align="center">
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Lead</p></th>
<th class="head"><p>YPL</p></th>
<th class="head"><p>YPL</p></th>
<th class="head"><p>URP</p></th>
<th class="head"><p>URP</p></th>
<th class="head"><p>DP</p></th>
<th class="head"><p>DP</p></th>
<th class="head"><p>UTS</p></th>
<th class="head"><p>UTS</p></th>
<th class="head"><p>TB</p></th>
<th class="head"><p>TB</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p></p></td>
<td><p>b</p></td>
<td><p>t</p></td>
<td><p>b</p></td>
<td><p>t</p></td>
<td><p>b</p></td>
<td><p>t</p></td>
<td><p>b</p></td>
<td><p>t</p></td>
<td><p>b</p></td>
<td><p>t</p></td>
</tr>
<tr class="row-odd"><td><p><strong>-4</strong></p></td>
<td><p>0.07</p></td>
<td><p>7.20</p></td>
<td><p>-1.05</p></td>
<td><p>-3.50</p></td>
<td><p>-0.19</p></td>
<td><p>-1.60</p></td>
<td><p>-0.08</p></td>
<td><p>-0.80</p></td>
<td><p>-0.01</p></td>
<td><p>-0.20</p></td>
</tr>
<tr class="row-even"><td><p><strong>-3</strong></p></td>
<td><p>0.11</p></td>
<td><p>14.30</p></td>
<td><p>-1.24</p></td>
<td><p>-3.70</p></td>
<td><p>-0.32</p></td>
<td><p>-2.60</p></td>
<td><p>-0.15</p></td>
<td><p>-2.00</p></td>
<td><p>0.00</p></td>
<td><p>0.10</p></td>
</tr>
<tr class="row-odd"><td><p><strong>-2</strong></p></td>
<td><p>0.11</p></td>
<td><p>14.30</p></td>
<td><p>-1.51</p></td>
<td><p>-4.70</p></td>
<td><p>-0.43</p></td>
<td><p>-3.80</p></td>
<td><p>0.02</p></td>
<td><p>0.20</p></td>
<td><p>-0.03</p></td>
<td><p>-0.60</p></td>
</tr>
<tr class="row-even"><td><p><strong>-1</strong></p></td>
<td><p>0.09</p></td>
<td><p>7.40</p></td>
<td><p>-1.41</p></td>
<td><p>-4.30</p></td>
<td><p>-0.46</p></td>
<td><p>-4.00</p></td>
<td><p>0.03</p></td>
<td><p>0.40</p></td>
<td><p>-0.03</p></td>
<td><p>-0.80</p></td>
</tr>
<tr class="row-odd"><td><p><strong>0</strong></p></td>
<td><p>0.04</p></td>
<td><p>2.51</p></td>
<td><p>-1.25</p></td>
<td><p>-3.40</p></td>
<td><p>-0.44</p></td>
<td><p>-3.70</p></td>
<td><p>0.25</p></td>
<td><p>3.30</p></td>
<td><p>-0.08</p></td>
<td><p>-2.40</p></td>
</tr>
<tr class="row-even"><td><p><strong>1</strong></p></td>
<td><p>-0.01</p></td>
<td><p>-0.40</p></td>
<td><p>-1.04</p></td>
<td><p>-2.40</p></td>
<td><p>-0.27</p></td>
<td><p>-2.40</p></td>
<td><p>0.32</p></td>
<td><p>4.90</p></td>
<td><p>-0.10</p></td>
<td><p>-3.00</p></td>
</tr>
<tr class="row-odd"><td><p><strong>2</strong></p></td>
<td><p>-0.02</p></td>
<td><p>-1.70</p></td>
<td><p>-0.09</p></td>
<td><p>-0.20</p></td>
<td><p>-0.06</p></td>
<td><p>-0.50</p></td>
<td><p>0.33</p></td>
<td><p>4.60</p></td>
<td><p>-0.10</p></td>
<td><p>-3.00</p></td>
</tr>
<tr class="row-even"><td><p><strong>3</strong></p></td>
<td><p>-0.03</p></td>
<td><p>-2.10</p></td>
<td><p>0.09</p></td>
<td><p>0.20</p></td>
<td><p>0.01</p></td>
<td><p>0.10</p></td>
<td><p>0.27</p></td>
<td><p>3.00</p></td>
<td><p>-0.08</p></td>
<td><p>-2.10</p></td>
</tr>
</tbody>
</table>
</div><div class="custom-container">
<p><strong>Results</strong>:</p>
<ul class="simple">
<li><p>GNP growth precedes YPL(+), URP(-) and DP(-)</p></li>
<li><p>GNP growth follows UTS(+) and TB(-)</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The results of Chen’s Tables III and IV can be summarized in a very simple hypothesis about the relationship between the business cycle (level of GNP) and the Equity Risk Premium (ERP):</p>
<p><strong>Hypothesis: When GNP hits a peak (high past GNPG and low expected future GNPG), then ERP hits a trough (i.e., GNP and ERP have opposite cycles).</strong></p>
<p>Table III tells us where the predictors are when ERP is low:</p>
<ul class="simple">
<li><p>High YPL</p></li>
<li><p>Low URP</p></li>
<li><p>Low DP</p></li>
<li><p>Low UTS</p></li>
<li><p>High TB</p></li>
</ul>
<p>Table IV tells us where the predictors are when GNP peaks:</p>
<ul class="simple">
<li><p>High YPL (previous GNPG was high)</p></li>
<li><p>Low URP (previous high GNPG raised junk bond prices)</p></li>
<li><p>Low DP (previous high GNPG raised stock prices)</p></li>
<li><p>Low UTS (UTS is low when expected future GNPG is low)</p></li>
<li><p>High TB (TB is high when expected future GNPG is low)</p></li>
</ul>
<p>Given the hypothesis, the levels of the predictor variables in Table III and IV are the same.</p>
<p><strong>Notice in Table IV</strong>: YPL, URP and DP depend on previous GNPG, while UTS and TB depend upon expected future GNPG.</p>
<p>The argument can be repeated when GNP reaches a low level and ERP is high. Once again, the implications for the predictor variables in Table III will be consistent with the implications for the predictor variables from Table IV.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Next we use historical data to look at the predictivity of risk factors in Chen’s model.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
</section>
<section id="updated-chens-analysis">
<h2>Updated Chen’s analysis<a class="headerlink" href="#updated-chens-analysis" title="Permalink to this heading">#</a></h2>
<p>In the rest of the note we use updated data to reproduce the results in Chen’s model to the best we can, given data limitations.</p>
<p>First we study the predictability of Chen’s risk factors on market risk premium. We load risk factors and asset returns used in Chen’s model.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtered data for the period 1954-1986</span>
<span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">riskfactors_filtered</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1954-01-01&#39;</span><span class="p">:</span><span class="s1">&#39;1986-12-31&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the continuously compounded quarterly excess value-weighted NYSE index return</span>
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;quarterly_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;vwretx&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;Rfree&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>

<span class="c1"># Annualize &#39;def&#39;, &#39;term&#39;, &#39;tb30&#39; and adjust for quarterly selection</span>
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span> 
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> 
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Prepare the DataFrame for regression </span>
<span class="n">df_reg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;VW&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;quarterly_return&#39;</span><span class="p">],</span>
    <span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;UPR&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;UTS&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;TB&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;YPL&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;ypl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Function to run regression for a given lag</span>
<span class="k">def</span> <span class="nf">run_lagged_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dependent_var</span><span class="p">,</span> <span class="n">independent_vars</span><span class="p">,</span> <span class="n">lag</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">independent_vars</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>  <span class="c1"># Shift for lag</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">dependent_var</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>  <span class="c1"># Drop NaNs that were created by shifting</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Align y with X after dropping NaNs</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">rsquared</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Variables to loop over</span>
<span class="n">independent_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DP&#39;</span><span class="p">,</span> <span class="s1">&#39;UPR&#39;</span><span class="p">,</span> <span class="s1">&#39;UTS&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="s1">&#39;YPL&#39;</span><span class="p">]</span>
<span class="n">lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># We show only the first 4 lags in the interest of space</span>

<span class="c1"># Collecting results</span>
<span class="n">all_results</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">independent_vars</span><span class="p">}</span>
<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
    <span class="n">lag_results</span> <span class="o">=</span> <span class="n">run_lagged_regression</span><span class="p">(</span><span class="n">df_reg</span><span class="p">,</span> <span class="s1">&#39;VW&#39;</span><span class="p">,</span> <span class="n">independent_vars</span><span class="p">,</span> <span class="n">lag</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">independent_vars</span><span class="p">):</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lag_results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Formatting the output</span>
<span class="n">formatted_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">independent_vars</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">t_val</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>
        <span class="n">formatted_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;Lag&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span>
            <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coef</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">t_val</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">r_squared</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">})</span>

<span class="c1"># Display results</span>
<span class="n">df_display</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">formatted_results</span><span class="p">)</span>
<span class="n">pivot_table</span> <span class="o">=</span> <span class="n">df_display</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Lag&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pivot_table</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|   Lag | DP               | TB                | UPR              | UTS              | YPL                |
|------:|:-----------------|:------------------|:-----------------|:-----------------|:-------------------|
|     1 | 1.47 (1.97) 0.03 | -0.03 (-2.0) 0.03 | 6.63 (4.05) 0.11 | 1.64 (3.64) 0.09 | -0.35 (-3.51) 0.09 |
|     2 | 2.45 (3.37) 0.08 | -0.01 (-0.69) 0.0 | 5.55 (3.34) 0.08 | 0.85 (1.82) 0.03 | -0.34 (-3.39) 0.08 |
|     3 | 2.64 (3.65) 0.09 | -0.0 (-0.1) 0.0   | 2.61 (1.51) 0.02 | 0.69 (1.44) 0.02 | -0.31 (-3.07) 0.07 |
|     4 | 2.0 (2.72) 0.06  | 0.0 (0.14) 0.0    | 1.5 (0.87) 0.01  | 0.49 (1.03) 0.01 | -0.15 (-1.44) 0.02 |
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>The regression results indicate that:
Market risk premium is negatively correlated with YPL and TB, but is positively correlated with UTS. That is:</p>
<p>When ERP is low (Table III in Chen’s model), the model predicts:</p>
<ul class="simple">
<li><p>High YPL （-）</p></li>
<li><p>Low UPR  （+）</p></li>
<li><p>Low DP   （+）</p></li>
<li><p>Low UTS  （+）</p></li>
<li><p>High TB  （-）</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Next we study the predictability of Chen’s risk factors on the growth rate of GNP.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The following cell replicates Table IV from Chen (1991).</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtered data for the period 1954-1985Q4</span>
<span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">riskfactors_filtered</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1954-01-01&#39;</span><span class="p">:</span><span class="s1">&#39;1985-12-31&#39;</span><span class="p">]</span>

<span class="c1"># Annualize &#39;tb30&#39; for consistent comparison</span>
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span>
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span>
<span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30_annual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Prepare the DataFrame for regression </span>
<span class="n">df_reg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;REALGNPG&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;realgnpg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> 
    <span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;UPR&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;def_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;UTS&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;term_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;TB&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;tb30_annual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
    <span class="s1">&#39;YPL&#39;</span><span class="p">:</span> <span class="n">riskfactors_filtered</span><span class="p">[</span><span class="s1">&#39;ypl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Adjusting function to accommodate leads instead of lags</span>
<span class="k">def</span> <span class="nf">run_lead_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dependent_var</span><span class="p">,</span> <span class="n">independent_vars</span><span class="p">,</span> <span class="n">lead</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs regressions with specified leads for the dependent variable, keeping</span>
<span class="sd">    predictors lagged by one period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Adjust the data for lead; positive lead means future data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">dependent_var</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">lead</span><span class="p">)</span>  <span class="c1"># This shifts up for leads</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">independent_vars</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Predictor lagged by one period</span>
        <span class="n">valid_index</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">X</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_index</span><span class="p">]</span>
        <span class="n">y_valid</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">valid_index</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Add constant term for regression</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">t_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">r_squared</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">rsquared</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coef</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">t_val</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">r_squared</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Running the regression across different leads</span>
<span class="n">leads</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># From -4 to 4</span>
<span class="n">independent_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DP&#39;</span><span class="p">,</span> <span class="s1">&#39;UPR&#39;</span><span class="p">,</span> <span class="s1">&#39;UTS&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="s1">&#39;YPL&#39;</span><span class="p">]</span>  
<span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">lead</span><span class="p">:</span> <span class="n">run_lead_regression</span><span class="p">(</span><span class="n">df_reg</span><span class="p">,</span> <span class="s1">&#39;REALGNPG&#39;</span><span class="p">,</span> <span class="n">independent_vars</span><span class="p">,</span> <span class="n">lead</span><span class="p">)</span> <span class="k">for</span> <span class="n">lead</span> <span class="ow">in</span> <span class="n">leads</span><span class="p">}</span>

<span class="c1"># Formatting and displaying results</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">independent_vars</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_results</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|    | DP                   | UPR                  | UTS                  | TB                   | YPL                  |
|---:|:---------------------|:---------------------|:---------------------|:---------------------|:---------------------|
| -4 | -0.3937 (-1.25) 0.01 | -3.2827 (-4.93) 0.17 | -0.5849 (-3.11) 0.07 | -0.0031 (-0.45) 0.0  | 0.1441 (3.41) 0.09   |
| -3 | -0.7338 (-2.39) 0.04 | -3.9397 (-6.28) 0.24 | -0.5314 (-2.81) 0.06 | -0.0038 (-0.55) 0.0  | 0.2836 (8.08) 0.35   |
| -2 | -1.1134 (-3.78) 0.1  | -4.2742 (-7.12) 0.29 | -0.3956 (-2.08) 0.03 | -0.006 (-0.88) 0.01  | 0.3935 (16.53) 0.69  |
| -1 | -1.417 (-5.09) 0.17  | -4.3558 (-7.5) 0.31  | -0.2479 (-1.29) 0.01 | -0.0079 (-1.18) 0.01 | 0.4292 (24.99) 0.83  |
|  0 | -1.5833 (-5.94) 0.22 | -3.4418 (-5.57) 0.2  | 0.069 (0.36) 0.0     | -0.0149 (-2.27) 0.04 | 0.3289 (11.23) 0.5   |
|  1 | -1.4688 (-5.49) 0.2  | -1.8288 (-2.76) 0.06 | 0.5251 (2.85) 0.06   | -0.0236 (-3.78) 0.1  | 0.1757 (4.64) 0.15   |
|  2 | -1.077 (-3.84) 0.11  | -0.2192 (-0.32) 0.0  | 0.8996 (5.17) 0.18   | -0.0288 (-4.78) 0.16 | 0.0283 (0.7) 0.0     |
|  3 | -0.6232 (-2.13) 0.04 | 1.3347 (1.98) 0.03   | 1.1739 (7.16) 0.3    | -0.0313 (-5.23) 0.18 | -0.0804 (-1.99) 0.03 |
|  4 | -0.198 (-0.66) 0.0   | 2.2904 (3.5) 0.09    | 1.2661 (7.82) 0.34   | -0.0288 (-4.72) 0.16 | -0.1153 (-2.91) 0.07 |
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>Results show that:</p>
<ul class="simple">
<li><p>GNP growth precedes YPL(+), URP(-)</p></li>
<li><p>GNP growth follows UTS(+) and TB(-)</p></li>
</ul>
<p>These regression results substantiate the following prediction results in Chen’s table IV:</p>
<ul class="simple">
<li><p>High YPL (previous GNPG was high) (corr(laggnpg,YPL) &gt;0)</p></li>
<li><p>Low URP (previous high GNPG raised junk bond prices) (corr(laggnpg,URP) &lt; 0)</p></li>
<li><p>Low DP (previous high GNPG raised stock prices) (corr(laggnpg,DP) &lt; 0)</p></li>
<li><p>Low UTS (UTS is low when expected future GNPG is low) (corr(leadgnpg,UPS) &gt; 0)</p></li>
<li><p>High TB (TB is high when expected future GNPG is low) (corr(leadgnpg,TB) &lt;0)</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-contrarian-taa-versus-momentum-taa">
<h1>5. TAA: Contrarian TAA Versus Momentum TAA<a class="headerlink" href="#taa-contrarian-taa-versus-momentum-taa" title="Permalink to this heading">#</a></h1>
<p>To the degree that past returns tell us about future returns, an investor can be one of two types: a momentum investor or a contrarian investor.</p>
<p>A contrarian looks for reversals (investors who believe in negative correlation): invest after the index has fallen (because the index will rise from there) and get out after the index has risen (because the index will fall from there).</p>
<p>A momentum investor looks for continuations (investors who believe in positive correlation): invest after the market has started to go up because it will continue to go up and get out when the market has started to go down because it will continue go down.</p>
<p>But, there is no evidence of positive/negative serial correlation at any time interval, like a month, a quarter or a year; and, any longer.</p>
<p><strong>Two General Precautions:</strong></p>
<p>First, the profitability of either type of TAA depends upon the timing of the decisions, and that is part of science and part of art! TAA is HARD to do!</p>
<p>Second, note that the above discussion is related to the behavior of the stock index. There is ample empirical evidence of positive serial correlation at short time intervals for individual stocks. So, at the stock level, momentum investing could be quite profitable (even narrowly defined as just a function of previous stock price moves, so ignoring things like earnings momentum and other such metrics).</p>
<p>To summarize, the Chen’s predictive model shows:</p>
<p>The business cycle (seen as GNPG) is related to the predictor variables:</p>
<ul class="simple">
<li><p>High DP and high URP indicate previous GNPG was low (near an economic trough)</p></li>
<li><p>High TB and low UTS predict low GNPG in the near future
So, DP and URP and price level proxies that look backward at GNP growth
while TB and UTS, the interest rate variables, predict future GNP growth.</p></li>
</ul>
<p>Chen replicates the Fama-French results that the predictor variables relate to the ERP (equity risk premium):</p>
<ul class="simple">
<li><p>High DP, URP and UTS signal that the current ERP (equity risk premium) is high</p></li>
<li><p>High TB predicts that the current ERP is low.</p></li>
</ul>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style>
<div class="custom-container">
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-estimating-the-erp-directly">
<h1>6. TAA: Estimating the ERP Directly<a class="headerlink" href="#taa-estimating-the-erp-directly" title="Permalink to this heading">#</a></h1>
<p>We can decompose the equity risk premium (ERP), defined as the expected return on the stock index less the expected return on a riskless bond portfolio, to better estimate the components, and so the total, ERP.</p>
<div class="math notranslate nohighlight">
\[𝐸RP =𝐸[𝑟_{𝑠}]−𝐸[𝑟_{𝑏}]\]</div>
<p>where <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑏}]\)</span> is the expected return on a riskless bond portfolio with a maturity equal to the forecast horizon of the ERP and <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]\)</span> is the expected return on a stock portfolio (``the market’’). <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑏}]\)</span> is often taken to be the bond portfolio’s yield to maturity.
The stock <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]\)</span> can be developed from the following:
$<span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]=\frac{𝐷_{1}+𝑅_{1}+𝑀VE_{1}− MVE_{0}}{MVE_{0}}\)</span>$</p>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(𝐷_{1}\)</span> = total dividends paid on the index</p></li>
<li><p><span class="math notranslate nohighlight">\(𝑅_{1}\)</span> = total amount spent by companies on stock repurchases in the stock index</p></li>
<li><p><span class="math notranslate nohighlight">\(MVE_{0}\)</span> = total market value of the index at the start of the period, <span class="math notranslate nohighlight">\(t=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(𝑀VE_{1}\)</span> = total market value of the equity at the end of the period, <span class="math notranslate nohighlight">\(t=1\)</span>.</p></li>
</ul>
<p>Define <span class="math notranslate nohighlight">\(𝑅_{1}=−\Delta(𝑆)∗𝑘\)</span></p>
<p>where
<span class="math notranslate nohighlight">\(\Delta(𝑆)=𝑆_{1}− 𝑆_{0}\)</span> where this is negative when shares are repurchased by their companies and
<span class="math notranslate nohighlight">\(k\)</span> is price at which shares are repurchased.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(𝑆_{0}\)</span>= number of shares outstanding at the start of the period</p></li>
<li><p><span class="math notranslate nohighlight">\(𝑆_{1}\)</span> = number of shares outstanding at the end of the period</p></li>
<li><p><span class="math notranslate nohighlight">\(𝑃_{0}\)</span> = price per share at the start of the period and</p></li>
<li><p><span class="math notranslate nohighlight">\(𝑃_{1}\)</span> = price per share at the end of the period.</p></li>
</ul>
<p>Share repurchases are, for a company, a very convenient way to distribute funds to shareholders.</p>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style>
<div class="custom-container">
<p>Using this definition of <span class="math notranslate nohighlight">\(𝑅_{1}\)</span> and <span class="math notranslate nohighlight">\(𝑀VE_{𝑡} =𝑃_{𝑡} ∗𝑆_{𝑡}\)</span> (t is 0 or 1), we can rewrite:</p>
<div class="math notranslate nohighlight">
\[𝐸[𝑟_{𝑠}]=\frac{𝑑_{1}}{𝑃_{0}}+[\frac{\Delta(𝑆)}{𝑆_{0}}∗\frac{𝑃_{1}−𝑘}{𝑃_{0}}]+\frac{𝑃_{1}−𝑃_{0}}{𝑃_0}\]</div>
<p>with <span class="math notranslate nohighlight">\(𝑑_{1}\)</span> = dividends per share = <span class="math notranslate nohighlight">\(\frac{𝐷_{1}}{𝑆_{0}}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\frac{d_{1}}{P_{0}}\)</span> is dividend yield; <span class="math notranslate nohighlight">\(\frac{\Delta(S)}{S_{0}}*\frac{P_{1}−k}{P_{0}}\)</span> is repurchase adjustment, or <span class="math notranslate nohighlight">\(ra\)</span>; <span class="math notranslate nohighlight">\(\frac{𝑃_{1}−𝑃_{0}}{𝑃_0}\)</span> is capital gains.</p>
<p>A share repurchase means <span class="math notranslate nohighlight">\(\Delta(𝑆)&lt;0\)</span>, but also, the firm usually offers to buy shares back at a premium to market, so <span class="math notranslate nohighlight">\(𝑘&gt;𝑃_{1}\)</span>, so two negative terms in the repurchase adjustment means it will be positive, offsetting a drop in <span class="math notranslate nohighlight">\(𝑃_{1}\)</span> in the third term, the capital gain component, because the repurchase is dilutive.</p>
<p>The key component in estimated <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]\)</span> above is the capital gain return. By rewriting <span class="math notranslate nohighlight">\(𝑃_{0}=𝐸_{0}∗𝑝_{0}\)</span> where <span class="math notranslate nohighlight">\(𝑝_{0}=𝑃_{0}/𝐸_{0}\)</span>, the current trailing <span class="math notranslate nohighlight">\(P/E\)</span> ratio and <span class="math notranslate nohighlight">\(𝑃_{1}=𝐸_{1}∗𝑝_{1}\)</span> with <span class="math notranslate nohighlight">\(𝑝_{1}\)</span>= the end-of-period trailing <span class="math notranslate nohighlight">\(P/E\)</span> ratio, where <span class="math notranslate nohighlight">\(𝐸_{0}\)</span> is earnings per share last period and <span class="math notranslate nohighlight">\(𝐸_{1}\)</span> is <span class="math notranslate nohighlight">\(EPS\)</span> this period, we can express the capital gain return in terms of earnings growth and change in the trailing <span class="math notranslate nohighlight">\(P/E\)</span> multiple. Thus, in the capital gain return calculation, eliminating some terms of “second order importance,” we can conclude:</p>
<div class="math notranslate nohighlight">
\[\frac{P_{1}−P_{0}}{P_{0}}=g + i + rp\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(g\)</span> is the expected real growth in earnings</p></li>
<li><p><span class="math notranslate nohighlight">\(i\)</span> is the expected inflation</p></li>
<li><p><span class="math notranslate nohighlight">\(𝑟p\)</span> is the repricing effect, which equals <span class="math notranslate nohighlight">\(𝑝_{1}/p_{0}−1\)</span>, i.e. change in the <span class="math notranslate nohighlight">\(P/E\)</span> ratio over the period.</p></li>
</ul>
<p>Thus
$<span class="math notranslate nohighlight">\(𝐸RP =\frac{𝑑_{1}}{𝑃_{0}}+𝑟a +𝑔+𝑖+𝑟p − r_{f}\)</span>$</p>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{𝑑_{1}}{P_{0}}\)</span> is dividend yield; <span class="math notranslate nohighlight">\(\frac{𝑑_{1}}{P_{0}} + ra\)</span> is income return.</p></li>
<li><p><span class="math notranslate nohighlight">\(ra =\frac{\Delta(𝑆)}{𝑆_{0}}∗\frac{𝑃_{1}−𝑘}{𝑃_{0}}\)</span> is the repurchase adjustment</p></li>
</ul>
<p>And the other ERP components are defined directly above.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<section id="estimating-the-erp-directly-a-numerical-example">
<h2>Estimating the ERP Directly: A Numerical Example<a class="headerlink" href="#estimating-the-erp-directly-a-numerical-example" title="Permalink to this heading">#</a></h2>
<p>A report from Barclays Global Investors (now part of BlackRock Capital) provides some long-run annual estimates of these factors:</p>
<ul class="simple">
<li><p>Income return = dividend yield + repurchase adjustment = 4.4%</p></li>
<li><p>Real earnings growth = 1.7%</p></li>
<li><p>Inflation = 3.1%</p></li>
<li><p><span class="math notranslate nohighlight">\(P/E\)</span> repricing = 1.5%</p></li>
</ul>
<p>The income return of 4.4% comes, historically, mostly from dividend yield. However, in the last 20 years, share repurchases have become a much more popular way of distributing cash to shareholders (up by 20% over 20 years). One obvious reason is the tax advantage. Thus, going forward, one might expect a slightly higher, but still low dividend yield, say 2.5%, plus about a 1% share repurchase adjustment (if 5% of outstanding shares are repurchased at a 20% premium to closing price per share).</p>
<p>If we were making, say, an ERP call for the next ten years, we might use the long-run averages as our estimates:
<span class="math notranslate nohighlight">\(ERP = 4.4\% + 1.7\% + 3.1\% + 1.5\% - 4.9\% = 10.7\% - 4.9\% = 5.8\%\)</span></p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The following function calculates equity risk premium.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Function inputs:</span>
<span class="sd">d1: dividend yield</span>
<span class="sd">ra: repurchase adjustment</span>
<span class="sd">g: expected real growth rate</span>
<span class="sd">i: expected inflation</span>
<span class="sd">rp: repricing effect(change in P/E ratio)</span>
<span class="sd">rf: risk free rate&quot;&quot;&quot;</span>

<span class="n">erp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d1</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">rp</span><span class="p">,</span> <span class="n">rf</span><span class="p">:</span> <span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">ra</span> <span class="o">+</span> <span class="n">g</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">rp</span> <span class="o">-</span> <span class="n">rf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market risk premium ERP is </span><span class="si">{</span><span class="n">erp</span><span class="p">(</span><span class="mf">4.4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.7</span><span class="p">,</span><span class="w"> </span><span class="mf">3.1</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">4.9</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market risk premium ERP is </span><span class="si">{</span><span class="n">erp</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Market risk premium ERP is 0.0580
Market risk premium ERP is 0.0900
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>We can also plot the empirical trend of equity risk premium and the growth rate of GNP.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resample ERP to quarterly and scale both series by 100</span>
<span class="n">erp_quarterly</span> <span class="o">=</span> <span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;vwretx&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rfree&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">gnpg_quarterly</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;realgnpg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Ensure indexes are aligned for both series, dropping NaN values</span>
<span class="n">aligned_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">erp_quarterly</span><span class="p">,</span> <span class="n">gnpg_quarterly</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">aligned_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ERP&#39;</span><span class="p">,</span> <span class="s1">&#39;GNPG&#39;</span><span class="p">]</span>

<span class="c1"># Plotting</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aligned_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">aligned_data</span><span class="p">[</span><span class="s1">&#39;ERP&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERP (Quarterly)&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aligned_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">aligned_data</span><span class="p">[</span><span class="s1">&#39;GNPG&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GNPG&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Equity Risk Premium and GNPG (Quarterly)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calculating the annual correlation</span>
<span class="n">quarter_ends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;12-31&#39;</span><span class="p">]</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">qe</span> <span class="ow">in</span> <span class="n">quarter_ends</span><span class="p">:</span>
    <span class="n">specific_quarters</span> <span class="o">=</span> <span class="n">aligned_data</span><span class="p">[</span><span class="n">aligned_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">qe</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">specific_quarters</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">specific_quarters</span><span class="p">[</span><span class="s1">&#39;ERP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">specific_quarters</span><span class="p">[</span><span class="s1">&#39;GNPG&#39;</span><span class="p">])</span>
        <span class="n">correlations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

<span class="c1"># The correct annual correlation is the average of these specific quarter correlations</span>
<span class="n">annual_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">correlations</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annual Corr(ERP, GNPG) is </span><span class="si">{</span><span class="n">annual_corr</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/52da2d9f058e849ebd5bec1768dd3790e26eb8f39d5ed61e501d07aba8deccbd.png" src="_images/52da2d9f058e849ebd5bec1768dd3790e26eb8f39d5ed61e501d07aba8deccbd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Annual Corr(ERP, GNPG) is -0.0451
</pre></div>
</div>
</div>
</div>
<div class="custom-container">
<p>Of course, for TAA purposes, we want to make much shorter investment horizon calls. Suppose for the next year we believe inflation moderates, the economy will do well as it continues to recover, but the market will not advance on what might be a currently fairly-valued position:</p>
<blockquote>
<div><p>Income return = 3.5%</p>
</div></blockquote>
<blockquote>
<div><p>Real earnings growth = 3%</p>
</div></blockquote>
<blockquote>
<div><p>Inflation = 5%</p>
</div></blockquote>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(P/E\)</span> repricing = 1%</p>
</div></blockquote>
<blockquote>
<div><p>1-year bond yield = 3.5%</p>
</div></blockquote>
<p>So <span class="math notranslate nohighlight">\(ERP = 12.5\% – 3.5\% = 9\%\)</span>, or quite a bit more than the long-run ERP.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>Perhaps the most difficult estimate is the <span class="math notranslate nohighlight">\(P/E\)</span> repricing. The S&amp;P 500 <span class="math notranslate nohighlight">\(P/E\)</span> ratio has fluctuated from around 7 (in years like 1941, 1948 and as late as 1982) to over 35 in the tech boom of 1997. Prior to that, the <span class="math notranslate nohighlight">\(P/E\)</span> multiple had not exceeded 25 except barely and briefly in 1931 and 1992. It had climbed unsteadily from 1982 through 1997.</p>
<p>How can you forecast the <span class="math notranslate nohighlight">\(P/E\)</span> multiple? One simple way is to recall the Gordon constant perpetuity growth model:
$<span class="math notranslate nohighlight">\(𝑃_{0}=(𝑥∗𝐸_{1})/(𝐾−𝐺)\)</span>$</p>
<p>where <span class="math notranslate nohighlight">\(𝑥\)</span> is the payout ratio (dividend per share / earnings per share), so <span class="math notranslate nohighlight">\(𝑥∗𝐸_{1}\)</span> is expected dividends next year. <span class="math notranslate nohighlight">\(𝐾\)</span> is the risk-adjusted discount rate, and <span class="math notranslate nohighlight">\(𝐺\)</span> is the perpetual growth rate.</p>
<p>Thus, the forward <span class="math notranslate nohighlight">\(P/E\)</span> ratio is:
$<span class="math notranslate nohighlight">\(\frac{𝑃_{0}}{𝐸_{1}}=\frac{𝑥}{(𝐾−𝐺)}\)</span>$</p>
<p>So, you would attach a positive <span class="math notranslate nohighlight">\(P/E\)</span> repricing effect if, over the year you expect:</p>
<p>(i) payout ratio increases</p>
<p>(ii) risk-adjusted rate decreases (smaller <span class="math notranslate nohighlight">\(K\)</span>)</p>
<p>(iii) growth rate increases (bigger <span class="math notranslate nohighlight">\(G\)</span>)</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="taa-a-simple-taa-implementation">
<h1>7. TAA: A Simple TAA Implementation<a class="headerlink" href="#taa-a-simple-taa-implementation" title="Permalink to this heading">#</a></h1>
<p>Given expected bond and stock returns, we need to form a portfolio. Assume only two asset classes, bonds (b) and stock (s), with the following long-run reward and risk profiles:</p>
<div class="math notranslate nohighlight">
\[𝐸[𝑟_{𝑏}]=0.05 \text{and} \sigma_{𝑏}=0.10\]</div>
<div class="math notranslate nohighlight">
\[𝐸[𝑟_{𝑠}]=0.10 \text{and} \sigma_{𝑠}=0.20\]</div>
<p>The correlation of bond and stock returns is <span class="math notranslate nohighlight">\(\rho_{𝑏s} =0.60\)</span></p>
<p>Thus, the covariance of bond <span class="math notranslate nohighlight">\(b\)</span> and stock <span class="math notranslate nohighlight">\(s\)</span> is <span class="math notranslate nohighlight">\(\sigma_{𝑏s} =0.60*0.10*0.20 = 0.012\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑏}^{2}+\sigma_{𝑠}^{2}−2\sigma_{bs} =0.026\)</span></p>
<p>One portfolio construction technique is to use mean-variance analysis to give points along the efficient frontier:</p>
<blockquote>
<div><p>MVP (minimum variance portfolio): <span class="math notranslate nohighlight">\(𝑋_{𝑏}=1, 𝑋_{𝑠}=0,𝐸[r_{p}]=0.05\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑝}=0.10\)</span></p>
</div></blockquote>
<blockquote>
<div><p>Med-low risk portfolio: <span class="math notranslate nohighlight">\(𝑋_{𝑏}=0.778, 𝑋_{𝑠}=0.222,𝐸[r_{p}]=0.061\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑝}=0.11\)</span></p>
</div></blockquote>
<blockquote>
<div><p>Med risk portfolio: <span class="math notranslate nohighlight">\(𝑋_{𝑏}=0.55, 𝑋_{𝑠}=0.45,𝐸[r_{p}]=0.073\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑝}=0.13\)</span></p>
</div></blockquote>
<blockquote>
<div><p>Med-high risk portfolio: <span class="math notranslate nohighlight">\(𝑋_{𝑏}=0.333, 𝑋_{𝑠}=0.667,E[r_{p}]=0.083\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑝}=0.156\)</span></p>
</div></blockquote>
<blockquote>
<div><p>High risk portfolio: <span class="math notranslate nohighlight">\(𝑋_{𝑏}=0.111, 𝑋_{𝑠}=0.889,𝐸[r_{p}]=0.094\)</span> and <span class="math notranslate nohighlight">\(\sigma_{𝑝}=0.185\)</span></p>
</div></blockquote>
<p>We could just pick a point off of this efficient frontier. Assume we do this and the asset-liability solution to this long-run scenario is: <span class="math notranslate nohighlight">\(𝑋_{𝑏}=0.50, 𝑋_{𝑠}=0.50 \)</span>. This is quite close to the “55/45” mix off of the efficient frontier above. This gives us an “SAA allocation.” Now we want to implement a TAA methodology on top of the SAA allocation, moving us around the 50/50 mix depending on our shorter-term outlook for the stock market.
We can use this long-run SAA mix in the Sharpe Model to determine the client’s relative risk aversion (RRT):</p>
<p>Sharpe:</p>
<div class="math notranslate nohighlight">
\[K_{0}=\frac{\sigma_{𝐵}^{2}−\sigma_{𝐵S}}{\sigma_{𝐵}^{2}+\sigma_{𝑆}^{2}−2\sigma_{𝐵S}} = −0.002/0.026=−0.077\]</div>
<div class="math notranslate nohighlight">
\[𝐾_{1𝑡} =\frac{𝐸_{𝑡}[𝑟_{𝑆}]−𝐸[𝑟_{𝐵}]}{\sigma_{𝐵}^{2}+\sigma_{S}^2−2\sigma_{BS}}=0.050/0.026=1.923\]</div>
<p>At the SAA mix: <span class="math notranslate nohighlight">\(𝑋_{𝑠}=0.50=−0.077+(1.923)∗(𝑅RT)\)</span> or <span class="math notranslate nohighlight">\(𝑅𝑅T=0.300\)</span></p>
<p>We can now determine the client’s TAA mix for any forecast of <span class="math notranslate nohighlight">\(𝐸RP =𝐸_{𝑡} [𝑟_{𝑠}]−𝐸[𝑟_{𝑏}]\)</span>, which will alter the value of <span class="math notranslate nohighlight">\(𝐾_{1𝑡}\)</span> in the Sharpe formula.</p>
<p>If <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]=0.12\)</span> 𝑡hen <span class="math notranslate nohighlight">\(𝐾_{1𝑡} =0.070/0.026 =2.692\)</span> and <span class="math notranslate nohighlight">\(𝑋_{𝑠}=0.731\)</span></p>
<p>If <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]=0.08\)</span> then <span class="math notranslate nohighlight">\(𝐾_{1𝑡} =0.030/0.026=1.154\)</span> and <span class="math notranslate nohighlight">\(𝑋_{𝑠}=0.269\)</span></p>
<p>Our long-term <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]=0.10\)</span> leads to an SAA: <span class="math notranslate nohighlight">\(𝑋_{𝑠}=0.50\)</span>.</p>
<p>If our shorter-term TAA <span class="math notranslate nohighlight">\(𝐸[𝑟_{𝑠}]\)</span> is higher than 10%, we hold more than 50% in stocks, if our stock forecast is less than 10%, we hold less than 50% in stocks.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
<p>The following graph plots the variance and expected returns for different portfolios.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data</span>
<span class="n">rps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.061</span><span class="p">,</span> <span class="mf">0.073</span><span class="p">,</span> <span class="mf">0.083</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">]</span>
<span class="n">sigmaps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.156</span><span class="p">,</span> <span class="mf">0.185</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sigmaps</span><span class="p">,</span> <span class="n">rps</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Efficient Frontier&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Variance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Expected Return&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Adding text annotations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.104</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;Minimum Variance Portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.114</span><span class="p">,</span> <span class="mf">0.061</span><span class="p">,</span> <span class="s1">&#39;Med-low risk portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.134</span><span class="p">,</span> <span class="mf">0.073</span><span class="p">,</span> <span class="s1">&#39;Med risk portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.083</span><span class="p">,</span> <span class="s1">&#39;Med-high risk portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.189</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">,</span> <span class="s1">&#39;High risk portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/033b8160297c615f1d33143c6d332db2b366ab1e52d8d1447920c493473f9d81.png" src="_images/033b8160297c615f1d33143c6d332db2b366ab1e52d8d1447920c493473f9d81.png" />
</div>
</div>
<div class="custom-container">
<p>The following code calculate the stock weight in TAA strategy.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The following code calculates the stock weights in TAA strategy</span>
<span class="c1"># The stock weight is calculated based on the formula: K0 + RRT*K1</span>

<span class="c1"># Calculate K0</span>
<span class="k">def</span> <span class="nf">K0</span><span class="p">(</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">):</span>
  <span class="n">K0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_b</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">K0</span>

<span class="c1"># Calculate K1</span>
<span class="k">def</span> <span class="nf">K1</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">):</span>
  <span class="n">K1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span><span class="o">-</span><span class="n">rb</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_b</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">*</span><span class="n">sigma_s</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">K1</span>

<span class="c1"># Calculate stock weight</span>
<span class="k">def</span> <span class="nf">stock_weight</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">,</span><span class="n">RRT</span><span class="p">):</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">sigma_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma_s</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span>
  <span class="n">sigma_bs</span> <span class="o">=</span> <span class="n">corr</span><span class="o">*</span><span class="n">sigma_b</span><span class="o">*</span><span class="n">sigma_s</span>
  <span class="n">K0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigma_bs</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span>
  <span class="n">K1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span> <span class="o">-</span> <span class="n">rb</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span>
  <span class="k">return</span> <span class="n">K0</span><span class="o">+</span><span class="n">RRT</span><span class="o">*</span><span class="n">K1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#function input:</span>
<span class="n">rb</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">rs</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">sigma_b</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">sigma_s</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">corr</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">RRT</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stock weight is:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">stock_weight</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">rs</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">,</span><span class="n">sigma_s</span><span class="p">,</span><span class="n">corr</span><span class="p">,</span><span class="n">RRT</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>stock weight is: 0.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data preparation</span>
<span class="n">rb</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">sigma_b</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">sigma_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">RRT</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">stock_weights</span> <span class="o">=</span> <span class="n">stock_weight</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">sigma_s</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">RRT</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">stock_weights</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Expected Return&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Stock Weight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Stock Weight&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Stock Weight and Expected Return&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/023253373ee2dc814f170fcd112bf72bfcf15148c6df92c6898b7dbe2e3523e5.png" src="_images/023253373ee2dc814f170fcd112bf72bfcf15148c6df92c6898b7dbe2e3523e5.png" />
</div>
</div>
<div class="custom-container">
<p>The stock weight and expected return is not a monotonic relationship because the variance of stock increase with the expected return and investors adjust the risk.</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="custom-container">
</section>
<section class="tex2jax_ignore mathjax_ignore" id="appendix">
<h1>Appendix<a class="headerlink" href="#appendix" title="Permalink to this heading">#</a></h1>
<p>The code below shows you how you can construct the variables in the dataframe <code class="docutils literal notranslate"><span class="pre">riskfactors</span></code> step-by-step. It requires that you have access to WRDS (a username and a password).</p>
</div>
<style>
.custom-container {
    padding: 15px;
    border: 1px solid #2196f3;
    margin: auto;
    max-width: 1500px;
    margin-bottom: 20px;
    border-radius: 4px;
    color: #000000;
    background-color: #e1f5fe;
}
</style><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load monthly data downloaded from Goyal&#39;s website: https://sites.google.com/view/agoyal145</span>
<span class="n">csv_riskfactors</span> <span class="o">=</span> <span class="s1">&#39;Goyal_Monthly.csv&#39;</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_riskfactors</span><span class="p">)</span>
<span class="c1"># Now we transform the column yyyymm that looks like 187101.0 into two columns: year and month</span>
<span class="c1">## First drop the rows with missing values in the variable &#39;yyyymm&#39;</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">])</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">100</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">100</span>
<span class="c1">## Drop the yyyymm column for a cleaner dataframe</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yyyymm&#39;</span><span class="p">])</span>
<span class="c1">## Set the columns &#39;year&#39; and &#39;month&#39; as the first and second columns</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cols</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="c1">## Since we are interested in years 1941 onwards, we drop the rows with year less than 1941</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1941</span><span class="p">]</span>
<span class="c1"># Replace commas and convert to float for &#39;Index&#39;</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Now we need to index the data to move to a time series structure</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span> 
<span class="c1"># Convert Rfree to the same scale as other returns</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rfree&#39;</span><span class="p">]</span>
<span class="c1"># Calculate log returns of stock price + dividends</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Index&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;D12&#39;</span><span class="p">])</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log_lag&#39;</span><span class="p">]</span>
<span class="c1"># Compute excess market return, eRm</span>
<span class="c1"># Correction from previous explanation: eRm should be the market return minus the log of Rf</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;mktrf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Rf&#39;</span><span class="p">])</span>
<span class="c1"># Compute dividend-price ratio, dp</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;D12&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Index&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
<span class="c1"># Compute dividend yield, dy</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;D12&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Sp_log_lag&#39;</span><span class="p">])</span>
<span class="c1"># Compute earnings-price ratio, ep</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;ep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;E12&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;Index&#39;</span><span class="p">])</span>
<span class="c1"># Drop NaN values that result from lagging and log operations</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mktrf&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;ep&#39;</span><span class="p">,</span> <span class="s1">&#39;dp&#39;</span><span class="p">])</span>
<span class="c1"># Compute term = lty - tbl</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;tbl&#39;</span><span class="p">]</span>
<span class="c1">## Scaling term to be in percentage terms</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="c1"># Compute def: default yield spread: yield of BAA - AAA bond yield </span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;BAA&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;AAA&#39;</span><span class="p">]</span>
<span class="c1">## Scaling def to be in percentage terms</span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="c1"># Rename &#39;tbl&#39; to &#39;tb30&#39; and drop &#39;tbl&#39; </span>
<span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;tb30&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="p">[</span><span class="s1">&#39;tbl&#39;</span><span class="p">]</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tbl&#39;</span><span class="p">])</span>
<span class="c1"># Let&#39;s first import the library we need to pull FRED data</span>
<span class="c1"># Annual growth in industrial production</span>
<span class="n">industrial_production</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_fred</span><span class="p">(</span><span class="s1">&#39;INDPRO&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1941</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># The variable is a seasonally adjusted index with base in 2017=100, so we want to map it to an annual growth rate</span>
<span class="n">industrial_production</span> <span class="o">=</span> <span class="n">industrial_production</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
<span class="n">industrial_production</span> <span class="o">=</span> <span class="n">industrial_production</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">industrial_production</span> <span class="o">=</span> <span class="n">industrial_production</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">industrial_production</span> <span class="o">=</span> <span class="n">industrial_production</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INDPRO&#39;</span><span class="p">:</span> <span class="s1">&#39;ypl&#39;</span><span class="p">})</span>
<span class="c1"># Real GDP growth</span>
<span class="n">real_gdp</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_fred</span><span class="p">(</span><span class="s1">&#39;GDPC1&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1941</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">real_gdp</span> <span class="o">=</span> <span class="n">real_gdp</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
<span class="n">real_gdp</span> <span class="o">=</span> <span class="n">real_gdp</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">real_gdp</span> <span class="o">=</span> <span class="n">real_gdp</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">real_gdp</span> <span class="o">=</span> <span class="n">real_gdp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;GDPC1&#39;</span><span class="p">:</span> <span class="s1">&#39;realgnpg&#39;</span><span class="p">})</span>
<span class="c1">### CRSP from pandas.tseries.offsets import MonthEnd</span>
<span class="c1">#! NOTE THAT THIS CELL WILL TAKE MORE THAN 2 MINS TO RUN BECAUSE IT IS PULLING A LARGE DATASET FROM WRDS (Millions of Obs.)</span>
<span class="c1"># Establish connection to WRDS</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span> <span class="c1"># Input your WRDS username and password</span>
<span class="c1"># Define SQL query with necessary filters and join conditions applied upfront</span>
<span class="n">sql_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT a.permno, a.permco, a.date, b.shrcd, b.exchcd, </span>
<span class="s2">                   CAST(a.ret AS FLOAT) AS ret, </span>
<span class="s2">                   a.vol, a.shrout, </span>
<span class="s2">                   ABS(a.prc) AS prc, a.hexcd, a.hsiccd, </span>
<span class="s2">                   CAST(d.dlret AS FLOAT) AS dlret, d.dlstdt</span>
<span class="s2">            FROM crsp.msf AS a</span>
<span class="s2">            LEFT JOIN crsp.msenames AS b ON a.permno=b.permno AND b.namedt&lt;=a.date AND a.date&lt;=b.nameendt</span>
<span class="s2">            LEFT JOIN crsp.msedelist AS d ON a.permno=d.permno AND a.date=d.dlstdt</span>
<span class="s2">            WHERE a.date &gt;= &#39;1941-01-01&#39; AND a.date &lt;= &#39;2023-12-31&#39;</span>
<span class="s2">            AND b.shrcd IN (10, 11)</span>
<span class="s2">            &quot;&quot;&quot;</span>
<span class="n">crsp</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dlstdt&#39;</span><span class="p">])</span>

<span class="c1"># Convert dates to &#39;jdate&#39; format directly</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;jdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;dljdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;dlstdt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;dlstdt&#39;</span> <span class="ow">in</span> <span class="n">crsp</span> <span class="k">else</span> <span class="kc">None</span>
<span class="c1"># Handling delisting returns and price adjustments in a more vectorized manner</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;dlret&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;dlret&#39;</span><span class="p">],</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">])</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">])</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">])</span>
<span class="c1"># Calculate market equity</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;shrout&#39;</span><span class="p">]</span>
<span class="c1"># Drop unnecessary columns in a more efficient manner</span>
<span class="n">crsp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;dlret&#39;</span><span class="p">,</span> <span class="s1">&#39;dlstdt&#39;</span><span class="p">,</span> <span class="s1">&#39;prc&#39;</span><span class="p">,</span> <span class="s1">&#39;shrout&#39;</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Sort and filter final dataset more efficiently</span>
<span class="n">crsp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jdate&#39;</span><span class="p">,</span> <span class="s1">&#39;permco&#39;</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">crsp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># For Value-Weighted Returns (vwretx)</span>
<span class="c1"># Sum of (return * market equity) divided by sum of market equity for each date</span>
<span class="n">vwretx</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;jdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="c1"># For Equally-Weighted Returns (ewretx)</span>
<span class="c1"># Simple mean of returns for each date</span>
<span class="n">ewretx</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;jdate&#39;</span><span class="p">)[</span><span class="s1">&#39;ret_final&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1"># Combine the value-weighted and equally-weighted returns into a single DataFrame</span>
<span class="n">returns_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;jdate&#39;</span><span class="p">:</span> <span class="n">vwretx</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;vwretx&#39;</span><span class="p">:</span> <span class="n">vwretx</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;ewretx&#39;</span><span class="p">:</span> <span class="n">ewretx</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
<span class="c1"># Now we want to merge the dataframes we have created so far. returns_df needs to use jdate as DateTimeIndex and be renamed &quot;DATE&quot; to match the FRED dataframes. </span>
<span class="c1"># Rename jdate to DATE</span>
<span class="n">returns_df</span> <span class="o">=</span> <span class="n">returns_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;jdate&#39;</span><span class="p">:</span> <span class="s1">&#39;DATE&#39;</span><span class="p">})</span>
<span class="n">returns_df</span> <span class="o">=</span> <span class="n">returns_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;DATE&#39;</span><span class="p">)</span>
<span class="n">returns_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">returns_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="c1"># Merge with real_gdp and industrial_production into a single dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">returns_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">real_gdp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">industrial_production</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Now we move from DATE (DateTimeIndex) being end of month to DATE being the beginning of the next month</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">MonthEnd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># We rename the DateTimeIndex to date to match the riskfactors dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>
<span class="c1"># Now we are ready to merge the dataframes and create an &#39;expanded&#39; riskfactors dataframe</span>
<span class="c1"># First we push the beginning of the month to the end of the month for the riskfactors dataframe</span>
<span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">riskfactors</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">MonthEnd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Step 1: Merge DataFrames on their indexes. We&#39;ll use an outer join to ensure no data is lost during the merge</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">riskfactors</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="c1"># Step 2: Select the columns we want to keep</span>
<span class="n">riskfactors</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[[</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">,</span> <span class="s1">&#39;ypl&#39;</span><span class="p">,</span> <span class="s1">&#39;tb30&#39;</span><span class="p">,</span> <span class="s1">&#39;CRSP_SPvwx&#39;</span><span class="p">,</span> <span class="s1">&#39;realgnpg&#39;</span><span class="p">,</span> <span class="s1">&#39;mktrf&#39;</span><span class="p">,</span> <span class="s1">&#39;Rfree&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">,</span> <span class="s1">&#39;BAA&#39;</span><span class="p">,</span> <span class="s1">&#39;vwretx&#39;</span><span class="p">,</span> <span class="s1">&#39;ewretx&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "executablebooks/jupyter-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to COMM475 - Investment Policies | Tactical Asset Allocation
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   COMM475
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="" title=""><span class="show-for-sr"></span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/executablebooks/jupyter-book/LN_05_Tactical_Asset_Allocation_MR.ipynb" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="" data-urlpath="" data-branch=>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "LN_05_Tactical_Asset_Allocation_MR";
                const repoURL = "";
                const urlPath = "";
                const branch = ""
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>